<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.163">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Simon Chiu">
<meta name="dcterms.date" content="2024-03-15">

<title>Simon Chiu - Fraud Detection</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Simon Chiu</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data-analytics-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false">Data Analytics Projects</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data-analytics-projects">    
        <li>
    <a class="dropdown-item" href="../../Data_Analytics_Projects/Population Visual Analysis/Population_Visual_Analysis.html">
 <span class="dropdown-text">Population Visual Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Data_Analytics_Projects/Fraud Detection/Fraud_Detection.html">
 <span class="dropdown-text">Fruad Detection</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-quarto-tutorial-articles" role="button" data-bs-toggle="dropdown" aria-expanded="false">Quarto Tutorial Articles</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-quarto-tutorial-articles">    
        <li>
    <a class="dropdown-item" href="../../Quarto_tutorial_articles/Quarto_Article1/Quarto_Article1.html">
 <span class="dropdown-text">How to build a Quarto website</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Quarto_tutorial_articles/Quarto_Article2/Quarto_Article2.html">
 <span class="dropdown-text">Custom Quarto Website</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-powerbi-tutorial-articles" role="button" data-bs-toggle="dropdown" aria-expanded="false">PowerBI Tutorial Articles</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-powerbi-tutorial-articles">    
        <li>
    <a class="dropdown-item" href="../../PowerBI_tutorial_articles/Jira_with_PowerBI/Jira_with_PowerBI.html">
 <span class="dropdown-text">How to import data from Jira</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-useful-application" role="button" data-bs-toggle="dropdown" aria-expanded="false">Useful Application</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-useful-application">    
        <li>
    <a class="dropdown-item" href="../../Useful Application/Automated Writing Template/Web_crawling_poems_from_Wiki.html">
 <span class="dropdown-text">自動化宋詞練字本</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/simonchiu902/Personal-Website"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/shih-cheng-chiu-simon-183906163/"><i class="bi bi-linkedin" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">Home</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#tasks" id="toc-tasks" class="nav-link active" data-scroll-target="#tasks">1. Tasks</a>
  <ul class="collapse">
  <li><a href="#roc-curve" id="toc-roc-curve" class="nav-link" data-scroll-target="#roc-curve">ROC Curve</a></li>
  <li><a href="#precision-recall-curve" id="toc-precision-recall-curve" class="nav-link" data-scroll-target="#precision-recall-curve">Precision-Recall Curve</a></li>
  </ul></li>
  <li><a href="#import-packages" id="toc-import-packages" class="nav-link" data-scroll-target="#import-packages">2. Import Packages</a></li>
  <li><a href="#predefined-functions" id="toc-predefined-functions" class="nav-link" data-scroll-target="#predefined-functions">3. Predefined Functions</a></li>
  <li><a href="#read-data" id="toc-read-data" class="nav-link" data-scroll-target="#read-data">4. Read Data</a></li>
  <li><a href="#columns-descriptions" id="toc-columns-descriptions" class="nav-link" data-scroll-target="#columns-descriptions">5. Columns Descriptions</a></li>
  <li><a href="#eda" id="toc-eda" class="nav-link" data-scroll-target="#eda">6. EDA</a>
  <ul class="collapse">
  <li><a href="#eda-transaction" id="toc-eda-transaction" class="nav-link" data-scroll-target="#eda-transaction">6-1. EDA-Transaction</a>
  <ul class="collapse">
  <li><a href="#transactionid" id="toc-transactionid" class="nav-link" data-scroll-target="#transactionid">TransactionID</a></li>
  <li><a href="#isfraud" id="toc-isfraud" class="nav-link" data-scroll-target="#isfraud">isFraud</a></li>
  <li><a href="#transactiondt" id="toc-transactiondt" class="nav-link" data-scroll-target="#transactiondt">TransactionDT</a></li>
  <li><a href="#transactionamt" id="toc-transactionamt" class="nav-link" data-scroll-target="#transactionamt">TransactionAmt</a></li>
  <li><a href="#isfraud-transactiondt-transactionamt" id="toc-isfraud-transactiondt-transactionamt" class="nav-link" data-scroll-target="#isfraud-transactiondt-transactionamt">isFraud &amp; TransactionDT &amp; TransactionAmt</a></li>
  <li><a href="#isfraud-transactiondt-productcd" id="toc-isfraud-transactiondt-productcd" class="nav-link" data-scroll-target="#isfraud-transactiondt-productcd">isFraud &amp; TransactionDT &amp; ProductCD</a></li>
  <li><a href="#card1-6" id="toc-card1-6" class="nav-link" data-scroll-target="#card1-6">Card1-6</a></li>
  <li><a href="#address" id="toc-address" class="nav-link" data-scroll-target="#address">address</a></li>
  <li><a href="#p_email-domain" id="toc-p_email-domain" class="nav-link" data-scroll-target="#p_email-domain">P_Email domain</a></li>
  <li><a href="#r_email-domain" id="toc-r_email-domain" class="nav-link" data-scroll-target="#r_email-domain">R_Email domain</a></li>
  <li><a href="#c1-c14-d1-d9-m1-m9-vxxx" id="toc-c1-c14-d1-d9-m1-m9-vxxx" class="nav-link" data-scroll-target="#c1-c14-d1-d9-m1-m9-vxxx">C1-C14, D1-D9, M1-M9, Vxxx</a></li>
  </ul></li>
  <li><a href="#eda-id" id="toc-eda-id" class="nav-link" data-scroll-target="#eda-id">6-2. EDA-id</a>
  <ul class="collapse">
  <li><a href="#id_30" id="toc-id_30" class="nav-link" data-scroll-target="#id_30">id_30</a></li>
  <li><a href="#id_31" id="toc-id_31" class="nav-link" data-scroll-target="#id_31">id_31</a></li>
  <li><a href="#devicetype" id="toc-devicetype" class="nav-link" data-scroll-target="#devicetype">DeviceType</a></li>
  <li><a href="#deviceinfo" id="toc-deviceinfo" class="nav-link" data-scroll-target="#deviceinfo">DeviceInfo</a></li>
  </ul></li>
  <li><a href="#eda-summary" id="toc-eda-summary" class="nav-link" data-scroll-target="#eda-summary">6-3. EDA Summary</a></li>
  </ul></li>
  <li><a href="#modeling" id="toc-modeling" class="nav-link" data-scroll-target="#modeling">7. Modeling</a>
  <ul class="collapse">
  <li><a href="#select-useful-columns" id="toc-select-useful-columns" class="nav-link" data-scroll-target="#select-useful-columns">7-1. Select useful columns</a></li>
  <li><a href="#logistic-regression" id="toc-logistic-regression" class="nav-link" data-scroll-target="#logistic-regression">7-2. Logistic Regression</a></li>
  <li><a href="#decision-tree" id="toc-decision-tree" class="nav-link" data-scroll-target="#decision-tree">7-3. Decision Tree</a></li>
  <li><a href="#xgboost" id="toc-xgboost" class="nav-link" data-scroll-target="#xgboost">7-4. XGBoost</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">7-5. Conclusion</a></li>
  </ul></li>
  <li><a href="#conclusion-1" id="toc-conclusion-1" class="nav-link" data-scroll-target="#conclusion-1">8. Conclusion</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Fraud Detection</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Simon Chiu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 15, 2024</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="tasks" class="level1">
<h1>1. Tasks</h1>
<p>This data analytics project revolves around enhancing fraud detection in online financial transactions, a critical business use case vital for both consumers and businesses. The significance lies in the escalating threat of fraudulent activities within e-commerce, leading to substantial financial losses for businesses and potential security risks for consumers.</p>
<p>Our primary focus is to leverage a comprehensive dataset sourced from Vesta Corporation, a leading payment service company, to develop and refine machine learning models aimed at accurately distinguishing between legitimate and fraudulent transactions.</p>
<p>The original evaluation metric for this Kaggle competition is ROC AUC; however, due to the imbalance data problem (shown in isFruad section), I think it’s better to use Precision-Recall Curve AUC as the evaluation metric. Let’s talk about why.</p>
<section id="roc-curve" class="level2">
<h2 class="anchored" data-anchor-id="roc-curve">ROC Curve</h2>

<table>
<tbody><tr>
<td>
<img src="image/roc_curve.png" width="300" height="300">
</td>
<td>
<img src="image/tpr_fpr.png" width="400" height="300">
</td>
</tr>

</tbody></table>
<p>ROC curve uses True Positive Rate (TPR) and False Positive Rate (FPR) as y-axis and x-axis.</p>
<p>TPR indicates the model’s ability to distinguish postive data; FPR indicates the model’s ability to distinguish negative data. Thus, ROC curve shows the overall ability to distinguish postive and negative classes.</p>
<p>However, in imbalance dataset with small amount of TP, TNR is not what we care about.</p>
</section>
<section id="precision-recall-curve" class="level2">
<h2 class="anchored" data-anchor-id="precision-recall-curve">Precision-Recall Curve</h2>

<table>
<tbody><tr>
<td>
<img src="image/precision_recall_curve.png" width="300" height="300">
</td>
<td>
<img src="image/precision_recall.png" width="500" height="300">
</td>
</tr>

</tbody></table>
<p>Precision-Recall curve uses Precision and Recall as y-axis and x-axis.</p>
<p>Recall indicates the model’s ability to distinguish postive data; Precision indicates how many of the predicted positive cases are actually positive. Thus, Precision-Recall curve shows the overall ability to find as many as positive cases and also with a precise prediction.</p>
<p>Given our imbalanced dataset with a small number of TP and considering the real-world scenario of monitoring fraudulent transactions, utilizing the Precision-Recall curve would be prudent as it specifically emphasizes TP.</p>
</section>
</section>
<section id="import-packages" class="level1">
<h1>2. Import Packages</h1>
<div class="cell" data-tags="[]" data-execution_count="1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for modeling</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> precision_recall_curve, f1_score, auc, accuracy_score, confusion_matrix</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder, StandardScaler</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.utils <span class="im">import</span> resample</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.tree <span class="im">import</span> DecisionTreeClassifier </span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> xgboost <span class="im">import</span> XGBClassifier</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xgboost <span class="im">as</span> xgb</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="co"># for hyperparameter tunning</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> hyperopt <span class="im">import</span> hp</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> TimeSeriesSplit, GridSearchCV</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ignore all warnings</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="predefined-functions" class="level1">
<h1>3. Predefined Functions</h1>
<div class="cell" data-tags="[]" data-execution_count="4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to reduce the DF size</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reduce_mem_usage(df, verbose<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    numerics <span class="op">=</span> [<span class="st">'int16'</span>, <span class="st">'int32'</span>, <span class="st">'int64'</span>, <span class="st">'float16'</span>, <span class="st">'float32'</span>, <span class="st">'float64'</span>]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    start_mem <span class="op">=</span> df.memory_usage().<span class="bu">sum</span>() <span class="op">/</span> <span class="dv">1024</span><span class="op">**</span><span class="dv">2</span>    </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        col_type <span class="op">=</span> df[col].dtypes</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col_type <span class="kw">in</span> numerics:</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            c_min <span class="op">=</span> df[col].<span class="bu">min</span>()</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            c_max <span class="op">=</span> df[col].<span class="bu">max</span>()</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">str</span>(col_type)[:<span class="dv">3</span>] <span class="op">==</span> <span class="st">'int'</span>:</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> c_min <span class="op">&gt;</span> np.iinfo(np.int8).<span class="bu">min</span> <span class="kw">and</span> c_max <span class="op">&lt;</span> np.iinfo(np.int8).<span class="bu">max</span>:</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                    df[col] <span class="op">=</span> df[col].astype(np.int8)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> c_min <span class="op">&gt;</span> np.iinfo(np.int16).<span class="bu">min</span> <span class="kw">and</span> c_max <span class="op">&lt;</span> np.iinfo(np.int16).<span class="bu">max</span>:</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                    df[col] <span class="op">=</span> df[col].astype(np.int16)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> c_min <span class="op">&gt;</span> np.iinfo(np.int32).<span class="bu">min</span> <span class="kw">and</span> c_max <span class="op">&lt;</span> np.iinfo(np.int32).<span class="bu">max</span>:</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                    df[col] <span class="op">=</span> df[col].astype(np.int32)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> c_min <span class="op">&gt;</span> np.iinfo(np.int64).<span class="bu">min</span> <span class="kw">and</span> c_max <span class="op">&lt;</span> np.iinfo(np.int64).<span class="bu">max</span>:</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                    df[col] <span class="op">=</span> df[col].astype(np.int64)  </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> c_min <span class="op">&gt;</span> np.finfo(np.float16).<span class="bu">min</span> <span class="kw">and</span> c_max <span class="op">&lt;</span> np.finfo(np.float16).<span class="bu">max</span>:</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                    df[col] <span class="op">=</span> df[col].astype(np.float16)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> c_min <span class="op">&gt;</span> np.finfo(np.float32).<span class="bu">min</span> <span class="kw">and</span> c_max <span class="op">&lt;</span> np.finfo(np.float32).<span class="bu">max</span>:</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                    df[col] <span class="op">=</span> df[col].astype(np.float32)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                    df[col] <span class="op">=</span> df[col].astype(np.float64)    </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    end_mem <span class="op">=</span> df.memory_usage().<span class="bu">sum</span>() <span class="op">/</span> <span class="dv">1024</span><span class="op">**</span><span class="dv">2</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="st">'Mem. usage decreased to </span><span class="sc">{:5.2f}</span><span class="st"> Mb (</span><span class="sc">{:.1f}% r</span><span class="st">eduction)'</span>.<span class="bu">format</span>(end_mem, <span class="dv">100</span> <span class="op">*</span> (start_mem <span class="op">-</span> end_mem) <span class="op">/</span> start_mem))</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co">#summary of the dataframe</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> resumetable(df, columns):</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Dataset Shape: </span><span class="sc">{</span>df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    summary <span class="op">=</span> pd.DataFrame(df[columns].dtypes, columns<span class="op">=</span>[<span class="st">'dtypes'</span>])</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    summary <span class="op">=</span> summary.reset_index()</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    summary[<span class="st">'Name'</span>] <span class="op">=</span> summary[<span class="st">'index'</span>]</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    summary <span class="op">=</span> summary[[<span class="st">'Name'</span>, <span class="st">'dtypes'</span>]]</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    summary[<span class="st">'Missing'</span>] <span class="op">=</span> df[columns].isnull().<span class="bu">sum</span>().values</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    summary[<span class="st">'Uniques'</span>] <span class="op">=</span> df[columns].nunique().values</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    summary[<span class="st">'First Value'</span>] <span class="op">=</span> df[columns].iloc[<span class="dv">0</span>].values</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    summary[<span class="st">'Second Value'</span>] <span class="op">=</span> df[columns].iloc[<span class="dv">1</span>].values</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    summary[<span class="st">'Third Value'</span>] <span class="op">=</span> df[columns].iloc[<span class="dv">2</span>].values    </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> summary</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co">#plot two charts to perform in-depth analysis on different categorical columns</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co">#The top section (subplot 1) presents a count plot, illustrating the frequency of occurrences for each category and the corresponding percentage of fraudulent transactions. The bottom section (subplot 2) offers a bar plot depicting the total transaction amounts across different categories, coupled with the percentage of fraudulent transaction amounts. </span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ploting_cnt_amt(df, col, lim<span class="op">=</span><span class="dv">2000</span>):</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> pd.crosstab(df[col], df[<span class="st">'isFraud'</span>], normalize<span class="op">=</span><span class="st">'index'</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> tmp.reset_index()</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    tmp.rename(columns<span class="op">=</span>{<span class="dv">0</span>:<span class="st">'NoFraud'</span>, <span class="dv">1</span>:<span class="st">'Fraud'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">14</span>))    </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> Distributions '</span>, fontsize<span class="op">=</span><span class="dv">24</span>)</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">211</span>)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> sns.countplot( x<span class="op">=</span>col,  data<span class="op">=</span>df, order<span class="op">=</span><span class="bu">list</span>(tmp[col].values))</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>    gt <span class="op">=</span> g.twinx()</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    gt <span class="op">=</span> sns.pointplot(x<span class="op">=</span>col, y<span class="op">=</span><span class="st">'Fraud'</span>, data<span class="op">=</span>tmp, order<span class="op">=</span><span class="bu">list</span>(tmp[col].values),</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>                       color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>    gt.set_ylim(<span class="dv">0</span>,tmp[<span class="st">'Fraud'</span>].<span class="bu">max</span>()<span class="op">*</span><span class="fl">1.1</span>)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    gt.set_ylabel(<span class="st">"</span><span class="sc">% F</span><span class="st">raud Transactions"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>    g.set_title(<span class="ss">f"Count of </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> values and % Fraud Transactions"</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>    g.set_xlabel(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> Category Names"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    g.set_ylabel(<span class="ss">f"Count of </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">17</span>)</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>    g.set_xticklabels(g.get_xticklabels(),rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>    sizes <span class="op">=</span> []</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> g.patches:</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>        height <span class="op">=</span> p.get_height()</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>        sizes.append(height)</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>        g.text(p.get_x()<span class="op">+</span>p.get_width()<span class="op">/</span><span class="fl">2.</span>,</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>                height <span class="op">+</span> <span class="dv">3</span>,</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>                <span class="st">'</span><span class="sc">{:1.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(height<span class="op">/</span>total<span class="op">*</span><span class="dv">100</span>),</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">"center"</span>,fontsize<span class="op">=</span><span class="dv">12</span>) </span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>    g.set_ylim(<span class="dv">0</span>,<span class="bu">max</span>(sizes)<span class="op">*</span><span class="fl">1.15</span>)</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>    <span class="co">#########################################################################</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>    perc_amt <span class="op">=</span> (df.groupby([<span class="st">'isFraud'</span>,col])[<span class="st">'TransactionAmt'</span>].<span class="bu">sum</span>() <span class="op">\</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>                <span class="op">/</span> df.groupby([col])[<span class="st">'TransactionAmt'</span>].<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span>).unstack(<span class="st">'isFraud'</span>)</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>    perc_amt <span class="op">=</span> perc_amt.reset_index()</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>    perc_amt.rename(columns<span class="op">=</span>{<span class="dv">0</span>:<span class="st">'NoFraud'</span>, <span class="dv">1</span>:<span class="st">'Fraud'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>    amt <span class="op">=</span> df.groupby([col])[<span class="st">'TransactionAmt'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    perc_amt <span class="op">=</span> perc_amt.fillna(<span class="dv">0</span>)</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">212</span>)</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    g1 <span class="op">=</span> sns.barplot(x<span class="op">=</span>col, y<span class="op">=</span><span class="st">'TransactionAmt'</span>, </span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>                       data<span class="op">=</span>amt, </span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>                       order<span class="op">=</span><span class="bu">list</span>(tmp[col].values))</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>    g1t <span class="op">=</span> g1.twinx()</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>    g1t <span class="op">=</span> sns.pointplot(x<span class="op">=</span>col, y<span class="op">=</span><span class="st">'Fraud'</span>, data<span class="op">=</span>perc_amt, </span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>                        order<span class="op">=</span><span class="bu">list</span>(tmp[col].values),</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>                       color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>    g1t.set_ylim(<span class="dv">0</span>,perc_amt[<span class="st">'Fraud'</span>].<span class="bu">max</span>()<span class="op">*</span><span class="fl">1.1</span>)</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>    g1t.set_ylabel(<span class="st">"</span><span class="sc">% F</span><span class="st">raud Total Amount"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>    g.set_xticklabels(g.get_xticklabels(),rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>    g1.set_title(<span class="ss">f"Transaction Amount by </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> + % Fraud Transactions Amount"</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>    g1.set_xlabel(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> Category Names"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>    g1.set_ylabel(<span class="st">"Transaction Amount (US$)"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>    g1.set_xticklabels(g.get_xticklabels(),rotation<span class="op">=</span><span class="dv">45</span>)    </span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> g1.patches:</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>        height <span class="op">=</span> p.get_height()</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>        g1.text(p.get_x()<span class="op">+</span>p.get_width()<span class="op">/</span><span class="fl">2.</span>,</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>                height <span class="op">+</span> <span class="dv">3</span>,</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>                <span class="st">'</span><span class="sc">{:1.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(height<span class="op">/</span>total_amt<span class="op">*</span><span class="dv">100</span>),</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">"center"</span>,fontsize<span class="op">=</span><span class="dv">12</span>) </span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>    plt.subplots_adjust(hspace<span class="op">=</span><span class="fl">.4</span>, top <span class="op">=</span> <span class="fl">0.9</span>)</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate missing value percentage for a column</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_missing_percentage(df, column_name):</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>    missing_values <span class="op">=</span> df[column_name].isnull().<span class="bu">sum</span>()</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>    total_rows <span class="op">=</span> df.shape[<span class="dv">0</span>]</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>    missing_pct <span class="op">=</span> <span class="bu">round</span>(missing_values <span class="op">/</span> total_rows <span class="op">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Missing value percentage for </span><span class="sc">{</span>column_name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>missing_pct<span class="sc">}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For modeling</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"># group low frequency categorical values to avoid high dimensionality after performing one hot encoding</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> group_low_percentage_values(df, column, threshold<span class="op">=</span><span class="dv">1</span>, new_category<span class="op">=</span><span class="st">'others'</span>):</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> df[column].value_counts(normalize<span class="op">=</span><span class="va">True</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    values_to_group <span class="op">=</span> result[result <span class="op">&lt;</span> threshold].index.tolist()</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    df[column] <span class="op">=</span> df[column].<span class="bu">apply</span>(<span class="kw">lambda</span> x: new_category <span class="cf">if</span> x <span class="kw">in</span> values_to_group <span class="cf">else</span> x)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># since we're using time related data, it's better to split by date rather than traditional train test split</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> split_data_by_date(X_transformed, y, train_date, test_date):</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    x_train, y_train <span class="op">=</span> X_transformed.loc[:train_date], y.loc[:train_date]</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>    x_test, y_test <span class="op">=</span> X_transformed.loc[test_date:], y.loc[test_date:]</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x_train, y_train, x_test, y_test</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co"># upsampling for minor class</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> upsample_minority_class(X, target_column<span class="op">=</span><span class="st">'isFraud'</span>, random_state<span class="op">=</span><span class="dv">27</span>):</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    not_fraud <span class="op">=</span> X[X[target_column] <span class="op">==</span> <span class="dv">0</span>]</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    fraud <span class="op">=</span> X[X[target_column] <span class="op">==</span> <span class="dv">1</span>]</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Upsample minority class</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>    fraud_upsampled <span class="op">=</span> resample(fraud,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                              replace<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                              n_samples<span class="op">=</span><span class="bu">len</span>(not_fraud),</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                              random_state<span class="op">=</span>random_state)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine majority and upsampled minority</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    upsampled <span class="op">=</span> pd.concat([not_fraud, fraud_upsampled])</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> upsampled</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_results(y_true, y_pred):</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># F1 Score</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>    f1 <span class="op">=</span> f1_score(y_true, y_pred)</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"F1 Score: </span><span class="sc">{</span>f1<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Confusion matrix</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    conf_matrix <span class="op">=</span> confusion_matrix(y_true, y_pred)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Confusion Matrix:"</span>)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(conf_matrix)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Precision Recall</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate Precision and Recall</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>    TN, FP, FN, TP <span class="op">=</span> conf_matrix.ravel()</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>    precision <span class="op">=</span> TP <span class="op">/</span> (TP <span class="op">+</span> FP)</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>    recall <span class="op">=</span> TP <span class="op">/</span> (TP <span class="op">+</span> FN)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Precision is </span><span class="sc">{</span><span class="bu">round</span>(precision<span class="op">*</span><span class="dv">100</span>)<span class="sc">}</span><span class="ss"> %; Recall is </span><span class="sc">{</span><span class="bu">round</span>(recall<span class="op">*</span><span class="dv">100</span>)<span class="sc">}</span><span class="ss"> %"</span>)</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Precision-Recall Curve</span></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>    precision, recall, thresholds <span class="op">=</span> precision_recall_curve(y_true, y_pred)</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    pr_rc_auc <span class="op">=</span> auc(recall, precision)</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"PR-RC AUC: </span><span class="sc">{</span>pr_rc_auc<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot Precision-Recall Curve</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>    plt.plot(recall, precision, label<span class="op">=</span><span class="st">'Precision-Recall curve (area = </span><span class="sc">%0.2f</span><span class="st">)'</span> <span class="op">%</span> pr_rc_auc)</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Recall'</span>)</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Precision'</span>)</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'Precision-Recall Curve'</span>)</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>    plt.legend(loc<span class="op">=</span><span class="st">'lower left'</span>)</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>    <span class="co"># conclusion</span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>    TP_rate <span class="op">=</span> <span class="bu">round</span>(TP<span class="op">/</span>(FN<span class="op">+</span>TP)<span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>    FP_rate <span class="op">=</span> <span class="bu">round</span>(FP<span class="op">/</span>(FP<span class="op">+</span>TN)<span class="op">*</span><span class="dv">100</span>)</span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>    precision <span class="op">=</span> TP <span class="op">/</span> (TP <span class="op">+</span> FP)</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Can capture </span><span class="sc">{</span>TP_rate<span class="sc">}</span><span class="ss"> % of fraud transactions and the prediction precision is </span><span class="sc">{</span><span class="bu">round</span>(precision<span class="op">*</span><span class="dv">100</span>)<span class="sc">}</span><span class="ss"> %. </span><span class="sc">{</span>FP_rate<span class="sc">}</span><span class="ss"> % of non-fraud transactions are misclassified"</span>)</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="read-data" class="level1">
<h1>4. Read Data</h1>
<div class="cell" data-tags="[]" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>transaction <span class="op">=</span> pd.read_csv(<span class="st">'data/train_transaction.csv'</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>identity <span class="op">=</span> pd.read_csv(<span class="st">'data/train_identity.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="columns-descriptions" class="level1">
<h1>5. Columns Descriptions</h1>
<div class="cell" data-tags="[]" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>transaction_cols <span class="op">=</span> <span class="bu">list</span>(transaction.columns)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(transaction_cols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['TransactionID', 'isFraud', 'TransactionDT', 'TransactionAmt', 'ProductCD', 'card1', 'card2', 'card3', 'card4', 'card5', 'card6', 'addr1', 'addr2', 'dist1', 'dist2', 'P_emaildomain', 'R_emaildomain', 'C1', 'C2', 'C3', 'C4', 'C5', 'C6', 'C7', 'C8', 'C9', 'C10', 'C11', 'C12', 'C13', 'C14', 'D1', 'D2', 'D3', 'D4', 'D5', 'D6', 'D7', 'D8', 'D9', 'D10', 'D11', 'D12', 'D13', 'D14', 'D15', 'M1', 'M2', 'M3', 'M4', 'M5', 'M6', 'M7', 'M8', 'M9', 'V1', 'V2', 'V3', 'V4', 'V5', 'V6', 'V7', 'V8', 'V9', 'V10', 'V11', 'V12', 'V13', 'V14', 'V15', 'V16', 'V17', 'V18', 'V19', 'V20', 'V21', 'V22', 'V23', 'V24', 'V25', 'V26', 'V27', 'V28', 'V29', 'V30', 'V31', 'V32', 'V33', 'V34', 'V35', 'V36', 'V37', 'V38', 'V39', 'V40', 'V41', 'V42', 'V43', 'V44', 'V45', 'V46', 'V47', 'V48', 'V49', 'V50', 'V51', 'V52', 'V53', 'V54', 'V55', 'V56', 'V57', 'V58', 'V59', 'V60', 'V61', 'V62', 'V63', 'V64', 'V65', 'V66', 'V67', 'V68', 'V69', 'V70', 'V71', 'V72', 'V73', 'V74', 'V75', 'V76', 'V77', 'V78', 'V79', 'V80', 'V81', 'V82', 'V83', 'V84', 'V85', 'V86', 'V87', 'V88', 'V89', 'V90', 'V91', 'V92', 'V93', 'V94', 'V95', 'V96', 'V97', 'V98', 'V99', 'V100', 'V101', 'V102', 'V103', 'V104', 'V105', 'V106', 'V107', 'V108', 'V109', 'V110', 'V111', 'V112', 'V113', 'V114', 'V115', 'V116', 'V117', 'V118', 'V119', 'V120', 'V121', 'V122', 'V123', 'V124', 'V125', 'V126', 'V127', 'V128', 'V129', 'V130', 'V131', 'V132', 'V133', 'V134', 'V135', 'V136', 'V137', 'V138', 'V139', 'V140', 'V141', 'V142', 'V143', 'V144', 'V145', 'V146', 'V147', 'V148', 'V149', 'V150', 'V151', 'V152', 'V153', 'V154', 'V155', 'V156', 'V157', 'V158', 'V159', 'V160', 'V161', 'V162', 'V163', 'V164', 'V165', 'V166', 'V167', 'V168', 'V169', 'V170', 'V171', 'V172', 'V173', 'V174', 'V175', 'V176', 'V177', 'V178', 'V179', 'V180', 'V181', 'V182', 'V183', 'V184', 'V185', 'V186', 'V187', 'V188', 'V189', 'V190', 'V191', 'V192', 'V193', 'V194', 'V195', 'V196', 'V197', 'V198', 'V199', 'V200', 'V201', 'V202', 'V203', 'V204', 'V205', 'V206', 'V207', 'V208', 'V209', 'V210', 'V211', 'V212', 'V213', 'V214', 'V215', 'V216', 'V217', 'V218', 'V219', 'V220', 'V221', 'V222', 'V223', 'V224', 'V225', 'V226', 'V227', 'V228', 'V229', 'V230', 'V231', 'V232', 'V233', 'V234', 'V235', 'V236', 'V237', 'V238', 'V239', 'V240', 'V241', 'V242', 'V243', 'V244', 'V245', 'V246', 'V247', 'V248', 'V249', 'V250', 'V251', 'V252', 'V253', 'V254', 'V255', 'V256', 'V257', 'V258', 'V259', 'V260', 'V261', 'V262', 'V263', 'V264', 'V265', 'V266', 'V267', 'V268', 'V269', 'V270', 'V271', 'V272', 'V273', 'V274', 'V275', 'V276', 'V277', 'V278', 'V279', 'V280', 'V281', 'V282', 'V283', 'V284', 'V285', 'V286', 'V287', 'V288', 'V289', 'V290', 'V291', 'V292', 'V293', 'V294', 'V295', 'V296', 'V297', 'V298', 'V299', 'V300', 'V301', 'V302', 'V303', 'V304', 'V305', 'V306', 'V307', 'V308', 'V309', 'V310', 'V311', 'V312', 'V313', 'V314', 'V315', 'V316', 'V317', 'V318', 'V319', 'V320', 'V321', 'V322', 'V323', 'V324', 'V325', 'V326', 'V327', 'V328', 'V329', 'V330', 'V331', 'V332', 'V333', 'V334', 'V335', 'V336', 'V337', 'V338', 'V339']</code></pre>
</div>
</div>
<p><strong>Transaction columns description</strong>:</p>
<ul>
<li>TransactionDT: timedelta from a given reference datetime (not an actual timestamp), start date = ‘2017-12-01’</li>
<li>TransactionAMT: transaction payment amount in USD</li>
<li>ProductCD: product code, the product for each transaction</li>
<li>card1 - card6: payment card information, such as card type, card category, issue bank, country, etc.</li>
<li>addr: address, both addr is for purchaser, addr1 is billing region and addr2 is billing country</li>
<li>dist: distance, distances between (not limited) billing address, mailing address, zip code, IP address, phone area, etc.</li>
<li>P_ and (R__) emaildomain: purchaser and recipient email domain</li>
<li>C1-C14: counting, such as how many addresses are found to be associated with the payment card, etc. The actual meaning is masked.</li>
<li>D1-D15: timedelta, such as days between previous transaction, etc.</li>
<li>M1-M9: match, such as names on card and address, etc.</li>
<li>Vxxx: Vesta engineered rich features, including ranking, counting, and other entity relations.</li>
</ul>
<div class="cell" data-tags="[]" data-execution_count="8">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>identity_cols <span class="op">=</span> <span class="bu">list</span>(identity.columns)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(identity_cols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['TransactionID', 'id_01', 'id_02', 'id_03', 'id_04', 'id_05', 'id_06', 'id_07', 'id_08', 'id_09', 'id_10', 'id_11', 'id_12', 'id_13', 'id_14', 'id_15', 'id_16', 'id_17', 'id_18', 'id_19', 'id_20', 'id_21', 'id_22', 'id_23', 'id_24', 'id_25', 'id_26', 'id_27', 'id_28', 'id_29', 'id_30', 'id_31', 'id_32', 'id_33', 'id_34', 'id_35', 'id_36', 'id_37', 'id_38', 'DeviceType', 'DeviceInfo']</code></pre>
</div>
</div>
<p><strong>Identity columns description</strong>:</p>
<ul>
<li>id: network connection information (IP, ISP, Proxy, etc) and digital signature (UA/browser/os/version, etc) associated with transactions.</li>
</ul>
<p><strong>Numerous columns, including C1-C14, D1-D15, M1-M9, Vxxx, and id, obscure their true meanings. To derive meaningful business conclusions and recommendations, my focus will be on those explainable columns.</strong></p>
</section>
<section id="eda" class="level1">
<h1>6. EDA</h1>
<div class="cell" data-tags="[]" data-execution_count="9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">## REducing memory</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df_trans <span class="op">=</span> reduce_mem_usage(transaction)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>df_id <span class="op">=</span> reduce_mem_usage(identity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Mem. usage decreased to 542.35 Mb (69.4% reduction)
Mem. usage decreased to 25.86 Mb (42.7% reduction)</code></pre>
</div>
</div>
<section id="eda-transaction" class="level2">
<h2 class="anchored" data-anchor-id="eda-transaction">6-1. EDA-Transaction</h2>
<div class="cell" data-tags="[]" data-execution_count="10">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, df_trans.columns.tolist())[:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 394)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="10">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>TransactionID</td>
      <td>int32</td>
      <td>0</td>
      <td>590540</td>
      <td>2987000</td>
      <td>2987001</td>
      <td>2987002</td>
    </tr>
    <tr>
      <th>1</th>
      <td>isFraud</td>
      <td>int8</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>TransactionDT</td>
      <td>int32</td>
      <td>0</td>
      <td>573349</td>
      <td>86400</td>
      <td>86401</td>
      <td>86469</td>
    </tr>
    <tr>
      <th>3</th>
      <td>TransactionAmt</td>
      <td>float16</td>
      <td>0</td>
      <td>8195</td>
      <td>68.5</td>
      <td>29.0</td>
      <td>59.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ProductCD</td>
      <td>object</td>
      <td>0</td>
      <td>5</td>
      <td>W</td>
      <td>W</td>
      <td>W</td>
    </tr>
    <tr>
      <th>5</th>
      <td>card1</td>
      <td>int16</td>
      <td>0</td>
      <td>13553</td>
      <td>13926</td>
      <td>2755</td>
      <td>4663</td>
    </tr>
    <tr>
      <th>6</th>
      <td>card2</td>
      <td>float16</td>
      <td>8933</td>
      <td>500</td>
      <td>NaN</td>
      <td>404.0</td>
      <td>490.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>card3</td>
      <td>float16</td>
      <td>1565</td>
      <td>114</td>
      <td>150.0</td>
      <td>150.0</td>
      <td>150.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>card4</td>
      <td>object</td>
      <td>1577</td>
      <td>4</td>
      <td>discover</td>
      <td>mastercard</td>
      <td>visa</td>
    </tr>
    <tr>
      <th>9</th>
      <td>card5</td>
      <td>float16</td>
      <td>4259</td>
      <td>119</td>
      <td>142.0</td>
      <td>102.0</td>
      <td>166.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="transactionid" class="level3">
<h3 class="anchored" data-anchor-id="transactionid">TransactionID</h3>
<p>TransactionID has 590540 unique values, which is the same as df_trans’s rows, so that we can confirm TransactionID is a valid primary key.</p>
</section>
<section id="isfraud" class="level3">
<h3 class="anchored" data-anchor-id="isfraud">isFraud</h3>
<p>The fraudulent transactions, both in count and total amount, represent only a small portion of the overall transactions. This suggests an imbalance in the data, which is an issue we should consider when building models.</p>
<div class="cell" data-execution_count="11">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'TransactionAmt'</span>] <span class="op">=</span> df_trans[<span class="st">'TransactionAmt'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="bu">len</span>(df_trans)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>total_amt <span class="op">=</span> df_trans.groupby([<span class="st">'isFraud'</span>])[<span class="st">'TransactionAmt'</span>].<span class="bu">sum</span>().<span class="bu">sum</span>()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">6</span>))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">121</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.countplot(x<span class="op">=</span><span class="st">'isFraud'</span>, data<span class="op">=</span>df_trans, )</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>g.set_title(<span class="st">"Count of Transaction"</span>, fontsize<span class="op">=</span><span class="dv">22</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>g.set_xlabel(<span class="st">"Is fraud?"</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>g.set_ylabel(<span class="st">'Count'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> g.patches:</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> p.get_height()</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    g.text(p.get_x()<span class="op">+</span>p.get_width()<span class="op">/</span><span class="fl">2.</span>,</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>            height,</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'</span><span class="sc">{:1.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(height<span class="op">/</span>total<span class="op">*</span><span class="dv">100</span>),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>            ha<span class="op">=</span><span class="st">"center"</span>, fontsize<span class="op">=</span><span class="dv">15</span>) </span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>perc_amt <span class="op">=</span> (df_trans.groupby([<span class="st">'isFraud'</span>])[<span class="st">'TransactionAmt'</span>].<span class="bu">sum</span>())</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>perc_amt <span class="op">=</span> perc_amt.reset_index()</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">122</span>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>g1 <span class="op">=</span> sns.barplot(x<span class="op">=</span><span class="st">'isFraud'</span>, y<span class="op">=</span><span class="st">'TransactionAmt'</span>,  dodge<span class="op">=</span><span class="va">True</span>, data<span class="op">=</span>perc_amt)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>g1.set_title(<span class="st">"Transaction Amount"</span>, fontsize<span class="op">=</span><span class="dv">22</span>)</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>g1.set_xlabel(<span class="st">"Is fraud?"</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>g1.set_ylabel(<span class="st">'Total Transaction Amount Scalar'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> g1.patches:</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> p.get_height()</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    g1.text(p.get_x()<span class="op">+</span>p.get_width()<span class="op">/</span><span class="fl">2.</span>,</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>            height <span class="op">+</span> <span class="dv">3</span>,</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">'</span><span class="sc">{:1.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(height<span class="op">/</span>total_amt <span class="op">*</span> <span class="dv">100</span>),</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>            ha<span class="op">=</span><span class="st">"center"</span>, fontsize<span class="op">=</span><span class="dv">15</span>) </span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-12-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="transactiondt" class="level3">
<h3 class="anchored" data-anchor-id="transactiondt">TransactionDT</h3>
<ol type="1">
<li>Min Date: 2017-12-02 00:00:00, Max Date: 2018-06-01 23:58:51</li>
<li>The range of TransactionDT is about half a year</li>
<li>Fraudulent transactions are likely associated with Hours</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="12">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, [<span class="st">"TransactionDT"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 394)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="12">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>TransactionDT</td>
      <td>int32</td>
      <td>0</td>
      <td>573349</td>
      <td>86400</td>
      <td>86401</td>
      <td>86469</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Looking at the first, second and third value, it appears that the <code>TransactionDT</code> is structured in a format resembling a time delta measured in seconds. Let’s delve deeper into this for further exploration.</p>
<div class="cell" data-tags="[]" data-execution_count="13">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>TransactionDT_min <span class="op">=</span> df_trans[<span class="st">'TransactionDT'</span>].<span class="bu">min</span>()</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>TransactionDT_max <span class="op">=</span> df_trans[<span class="st">'TransactionDT'</span>].<span class="bu">max</span>()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>convert_to_days <span class="op">=</span> <span class="dv">24</span><span class="op">*</span><span class="dv">60</span><span class="op">*</span><span class="dv">60</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>TransactionDT_range <span class="op">=</span> (TransactionDT_max<span class="op">-</span>TransactionDT_min)<span class="op">/</span>convert_to_days</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min TransactionDT:</span><span class="sc">{</span>TransactionDT_min<span class="sc">}</span><span class="ss">; Max TransactionDT:</span><span class="sc">{</span>TransactionDT_max<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"TransactionDT Range (days):</span><span class="sc">{</span>TransactionDT_range<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The range of TransactionDT is about half a year."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Min TransactionDT:86400; Max TransactionDT:15811131
TransactionDT Range (days):181.99920138888888
The range of TransactionDT is about half a year.</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="14">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>START_DATE <span class="op">=</span> <span class="st">'2017-12-01'</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>startdate <span class="op">=</span> datetime.datetime.strptime(START_DATE, <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">"Date"</span>] <span class="op">=</span> df_trans[<span class="st">'TransactionDT'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: (startdate <span class="op">+</span> datetime.timedelta(seconds<span class="op">=</span>x)))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'_Weekdays'</span>] <span class="op">=</span> df_trans[<span class="st">'Date'</span>].dt.dayofweek</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'_Hours'</span>] <span class="op">=</span> df_trans[<span class="st">'Date'</span>].dt.hour</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'_Days'</span>] <span class="op">=</span> df_trans[<span class="st">'Date'</span>].dt.day</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>min_date, max_date <span class="op">=</span> df_trans[<span class="st">"Date"</span>].<span class="bu">min</span>(), df_trans[<span class="st">"Date"</span>].<span class="bu">max</span>()</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min Date: </span><span class="sc">{</span>min_date<span class="sc">}</span><span class="ss">, Max Date: </span><span class="sc">{</span>max_date<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Min Date: 2017-12-02 00:00:00, Max Date: 2018-06-01 23:58:51</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="15">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subplots with shared y-axis</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> plt.subplot(<span class="dv">131</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>ax1.plot(df_trans.groupby(<span class="st">'_Days'</span>).mean()[<span class="st">'isFraud'</span>])</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Day of Month'</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Fraction of fraudulent transactions'</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.subplot(<span class="dv">132</span>, sharey<span class="op">=</span>ax1)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>ax2.plot(df_trans.groupby(<span class="st">'_Weekdays'</span>).mean()[<span class="st">'isFraud'</span>])</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Day of week'</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Fraction of fraudulent transactions'</span>)</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.subplot(<span class="dv">133</span>, sharey<span class="op">=</span>ax1)  <span class="co"># Share y-axis with ax1</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>ax2.plot(df_trans.groupby(<span class="st">'_Hours'</span>).mean()[<span class="st">'isFraud'</span>])</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Hour'</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Fraction of fraudulent transactions'</span>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Fraudulent Transactions Distribution by Day of Month/ Day of week/ Hour"</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>It appears that fraudulent transactions are more closely associated with the hour of the day rather than the day of the week. We can consider this as one of the feature for our model.</p>
</section>
<section id="transactionamt" class="level3">
<h3 class="anchored" data-anchor-id="transactionamt">TransactionAmt</h3>
<ol type="1">
<li>The distribution of TransactionAmt is quite skewed.</li>
<li>After log transfomration, fraud’s TransactionAmt is more spread out between Q1 and Q3.</li>
<li>After log transformation, Not Fruad has more outliers.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="16">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'TransactionAmt'</span>].plot(kind<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>          bins<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>          figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>),</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'Distribution of Transaction Amt'</span>)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The distribution of TransactionAmt is quite skewwed, so let’s convert it with log transformation</p>
<div class="cell" data-tags="[]" data-execution_count="17">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'TransactionAmt'</span>] <span class="op">\</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(np.log) <span class="op">\</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    .plot(kind<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>          bins<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>          figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>),</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'Distribution of Log Transaction Amt'</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="18">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>color_pal <span class="op">=</span> [x[<span class="st">'color'</span>] <span class="cf">for</span> x <span class="kw">in</span> plt.rcParams[<span class="st">'axes.prop_cycle'</span>]]</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>fig, ((ax1, ax2), (ax3, ax4)) <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>df_trans.loc[df_trans[<span class="st">'isFraud'</span>] <span class="op">==</span> <span class="dv">1</span>] <span class="op">\</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'TransactionAmt'</span>].<span class="bu">apply</span>(np.log) <span class="op">\</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    .plot(kind<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>          bins<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'Log Transaction Amt - Fraud'</span>,</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>          color<span class="op">=</span>color_pal[<span class="dv">1</span>],</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>          xlim<span class="op">=</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">10</span>),</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>         ax<span class="op">=</span> ax1)</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>df_trans.loc[df_trans[<span class="st">'isFraud'</span>] <span class="op">==</span> <span class="dv">0</span>] <span class="op">\</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'TransactionAmt'</span>].<span class="bu">apply</span>(np.log) <span class="op">\</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    .plot(kind<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>          bins<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'Log Transaction Amt - Not Fraud'</span>,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>          color<span class="op">=</span>color_pal[<span class="dv">2</span>],</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>          xlim<span class="op">=</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">10</span>),</span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>         ax<span class="op">=</span>ax2)</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>df_trans.loc[df_trans[<span class="st">'isFraud'</span>] <span class="op">==</span> <span class="dv">1</span>] <span class="op">\</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'TransactionAmt'</span>] <span class="op">\</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    .plot(kind<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>          bins<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'Transaction Amt - Fraud'</span>,</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>          color<span class="op">=</span>color_pal[<span class="dv">1</span>],</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>         ax<span class="op">=</span> ax3)</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>df_trans.loc[df_trans[<span class="st">'isFraud'</span>] <span class="op">==</span> <span class="dv">0</span>] <span class="op">\</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'TransactionAmt'</span>] <span class="op">\</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>    .plot(kind<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>          bins<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'Transaction Amt - Not Fraud'</span>,</span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>          color<span class="op">=</span>color_pal[<span class="dv">2</span>],</span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a>         ax<span class="op">=</span>ax4)</span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="19">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply log transformation to transaction amounts</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'Log_TransactionAmt'</span>] <span class="op">=</span> np.log(df_trans[<span class="st">'TransactionAmt'</span>] <span class="op">+</span> <span class="dv">1</span>)  <span class="co"># Adding 1 to avoid log(0)</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">'isFraud'</span>, y<span class="op">=</span><span class="st">'Log_TransactionAmt'</span>, data<span class="op">=</span>df_trans)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Log Transaction Amount Distribution - Not Fraud vs Fraud'</span>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Fraud Status'</span>)</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Log Transaction Amount'</span>)</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="isfraud-transactiondt-transactionamt" class="level3">
<h3 class="anchored" data-anchor-id="isfraud-transactiondt-transactionamt">isFraud &amp; TransactionDT &amp; TransactionAmt</h3>
<ol type="1">
<li>fraud rate occurs between 4 am to 11 am, characterized by fewer transactions and lower transaction amounts.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="20">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ploting_cnt_amt(df_trans, <span class="st">'_Hours'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-21-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>When initially analyzing TransactionDT in the previous section, we observed variations in the fraud rate across different hours. Subsequently, examining the two charts above, we identify that the fraud rate occurs between 4 am to 11 am, characterized by fewer transactions and lower transaction amounts. A plausible business hypothesis could suggest that these types of fraud might originate overseas, potentially in different time zones from the local time.</p>
</section>
<section id="isfraud-transactiondt-productcd" class="level3">
<h3 class="anchored" data-anchor-id="isfraud-transactiondt-productcd">isFraud &amp; TransactionDT &amp; ProductCD</h3>
<ol type="1">
<li>Product C has the highest fraud rate, which is 6 times than Product W.</li>
<li>The main product W has the lowest fraud rate.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="21">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, [<span class="st">'ProductCD'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 399)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="21">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ProductCD</td>
      <td>object</td>
      <td>0</td>
      <td>5</td>
      <td>W</td>
      <td>W</td>
      <td>W</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="22">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>ploting_cnt_amt(df_trans, <span class="st">'ProductCD'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-23-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="card1-6" class="level3">
<h3 class="anchored" data-anchor-id="card1-6">Card1-6</h3>
<ul>
<li>card4 (issuer company):
<ol type="1">
<li>Visa and Mastercard are the two main issuer companies and these two companies have similar fraudd rate.</li>
<li>Discover has the highest fraud rate.</li>
</ol></li>
<li>card6 (card type):
<ol type="1">
<li>debit and credit card are the two main types.</li>
<li>credit card is less common but with higher fraud rate.</li>
</ol></li>
</ul>
<div class="cell" data-tags="[]" data-execution_count="23">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, [<span class="st">'card1'</span>, <span class="st">'card2'</span>, <span class="st">'card3'</span>,<span class="st">'card4'</span>, <span class="st">'card5'</span>, <span class="st">'card6'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 399)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="23">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>card1</td>
      <td>int16</td>
      <td>0</td>
      <td>13553</td>
      <td>13926</td>
      <td>2755</td>
      <td>4663</td>
    </tr>
    <tr>
      <th>1</th>
      <td>card2</td>
      <td>float16</td>
      <td>8933</td>
      <td>500</td>
      <td>NaN</td>
      <td>404.0</td>
      <td>490.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>card3</td>
      <td>float16</td>
      <td>1565</td>
      <td>114</td>
      <td>150.0</td>
      <td>150.0</td>
      <td>150.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>card4</td>
      <td>object</td>
      <td>1577</td>
      <td>4</td>
      <td>discover</td>
      <td>mastercard</td>
      <td>visa</td>
    </tr>
    <tr>
      <th>4</th>
      <td>card5</td>
      <td>float16</td>
      <td>4259</td>
      <td>119</td>
      <td>142.0</td>
      <td>102.0</td>
      <td>166.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>card6</td>
      <td>object</td>
      <td>1571</td>
      <td>4</td>
      <td>credit</td>
      <td>credit</td>
      <td>debit</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Out of the provided variables, four are numeric, and two are categorical. As the dataset lacks explicit definitions for the numeric variables, let’s concentrate on the categorical ones, which we can infer likely represent the card issuer company and card type.</p>
<div class="cell" data-tags="[]" data-execution_count="24">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_trans, <span class="st">'card4'</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>df_trans.card4 <span class="op">=</span> df_trans.card4.fillna(<span class="st">'NAN'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for card4: 0.27%</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="25">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ploting_cnt_amt(df_trans, <span class="st">'card4'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-26-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="26">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_trans, <span class="st">'card6'</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>df_trans.card6 <span class="op">=</span> df_trans.card6.fillna(<span class="st">'NAN'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for card6: 0.27%</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="27">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>ploting_cnt_amt(df_trans, <span class="st">'card6'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-28-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="address" class="level3">
<h3 class="anchored" data-anchor-id="address">address</h3>
<ul>
<li>addr1:
<ol type="1">
<li>Some addr1 have lower transaction and transaction amount but with higher fraud rate, which may imply addr1 is a factor of fraud rate.</li>
<li>Missing values of addr1 have much higher fraud rate, which may be a good indicator for fraud.</li>
</ol></li>
<li>addr2:
<ol type="1">
<li>99% is the same value, which indicates that it may not be a meaningful variable to predict fraud.</li>
</ol></li>
</ul>
<div class="cell" data-tags="[]" data-execution_count="28">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, [<span class="st">'addr1'</span>, <span class="st">'addr2'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 399)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="28">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>addr1</td>
      <td>float16</td>
      <td>65706</td>
      <td>332</td>
      <td>315.0</td>
      <td>325.0</td>
      <td>330.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>addr2</td>
      <td>float16</td>
      <td>65706</td>
      <td>74</td>
      <td>87.0</td>
      <td>87.0</td>
      <td>87.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>addr1 and addr2 should be categorical, so let’s transform them first.</p>
<div class="cell" data-tags="[]" data-execution_count="29">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'addr1'</span>] <span class="op">=</span> df_trans[<span class="st">'addr1'</span>].astype(<span class="st">'object'</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'addr2'</span>] <span class="op">=</span> df_trans[<span class="st">'addr2'</span>].astype(<span class="st">'object'</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, [<span class="st">'addr1'</span>, <span class="st">'addr2'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 399)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="29">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>addr1</td>
      <td>object</td>
      <td>65706</td>
      <td>332</td>
      <td>315.0</td>
      <td>325.0</td>
      <td>330.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>addr2</td>
      <td>object</td>
      <td>65706</td>
      <td>74</td>
      <td>87.0</td>
      <td>87.0</td>
      <td>87.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="30">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_trans, <span class="st">'addr1'</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_trans, <span class="st">'addr2'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for addr1: 11.13%
Missing value percentage for addr2: 11.13%</code></pre>
</div>
</div>
<p>Let’s fill missing values with “NAN”</p>
<div class="cell" data-tags="[]" data-execution_count="31">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df_trans.addr1 <span class="op">=</span> df_trans.addr1.fillna(<span class="st">'NAN'</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>df_trans.addr2 <span class="op">=</span> df_trans.addr2.fillna(<span class="st">'NAN'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="32">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> df_trans.groupby([<span class="st">'addr1'</span>])[<span class="st">'addr1'</span>].count().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>total_count <span class="op">=</span> result.<span class="bu">sum</span>()</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>result_percentage <span class="op">=</span> (result <span class="op">/</span> total_count) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>result_percentage</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>addr1
NAN      11.126427
299.0     7.846209
325.0     7.239306
204.0     7.115521
264.0     6.751448
           ...    
425.0     0.000169
227.0     0.000169
232.0     0.000169
417.0     0.000169
427.0     0.000169
Name: addr1, Length: 333, dtype: float64</code></pre>
</div>
</div>
<p>There are 332 unique values, let’s focus on addr1 that appears more than 1%</p>
<div class="cell" data-tags="[]" data-execution_count="33">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> result_percentage[result_percentage <span class="op">&gt;</span> <span class="dv">1</span>].index</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>selected_rows <span class="op">=</span> df_trans.loc[df_trans.addr1.isin(indices)]</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>ploting_cnt_amt(selected_rows, <span class="st">'addr1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-34-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="34">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> df_trans.groupby([<span class="st">'addr2'</span>])[<span class="st">'addr2'</span>].count().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>total_count <span class="op">=</span> result.<span class="bu">sum</span>()</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>result_percentage <span class="op">=</span> (result <span class="op">/</span> total_count) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>result_percentage</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="34">
<pre><code>addr2
87.0    88.136451
NAN     11.126427
60.0     0.522234
96.0     0.108037
32.0     0.015410
          ...    
22.0     0.000169
25.0     0.000169
50.0     0.000169
49.0     0.000169
55.0     0.000169
Name: addr2, Length: 75, dtype: float64</code></pre>
</div>
</div>
<p>Almost all addr2 is 87, which indicates that this may not be a meaningful variable.</p>
</section>
<section id="p_email-domain" class="level3">
<h3 class="anchored" data-anchor-id="p_email-domain">P_Email domain</h3>
<ol type="1">
<li>Most transactions come from Google, Yahoo and missing value.</li>
<li>While Microsoft has the 4th highest transaction, it has the 1st fraud rate.</li>
<li>While spectrum has relatively low fraud rate, it has the 1st percentage of fraud amount.</li>
<li>es has higher fraud rate and amount.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="35">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, [<span class="st">'P_emaildomain'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 399)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="35">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>P_emaildomain</td>
      <td>object</td>
      <td>94456</td>
      <td>59</td>
      <td>NaN</td>
      <td>gmail.com</td>
      <td>outlook.com</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="36">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_trans, <span class="st">'P_emaildomain'</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>df_trans.P_emaildomain <span class="op">=</span> df_trans.P_emaildomain.fillna(<span class="st">'NAN'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for P_emaildomain: 15.99%</code></pre>
</div>
</div>
<p>Let’s first rename similar domains to a same group of domain.</p>
<div class="cell" data-tags="[]" data-execution_count="37">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>emails <span class="op">=</span> {<span class="st">'gmail'</span>: <span class="st">'google'</span>, <span class="st">'att.net'</span>: <span class="st">'att'</span>, <span class="st">'twc.com'</span>: <span class="st">'spectrum'</span>, </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">'scranton.edu'</span>: <span class="st">'other'</span>, <span class="st">'optonline.net'</span>: <span class="st">'other'</span>, <span class="st">'hotmail.co.uk'</span>: <span class="st">'microsoft'</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">'comcast.net'</span>: <span class="st">'other'</span>, <span class="st">'yahoo.com.mx'</span>: <span class="st">'yahoo'</span>, <span class="st">'yahoo.fr'</span>: <span class="st">'yahoo'</span>,</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">'yahoo.es'</span>: <span class="st">'yahoo'</span>, <span class="st">'charter.net'</span>: <span class="st">'spectrum'</span>, <span class="st">'live.com'</span>: <span class="st">'microsoft'</span>, </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">'aim.com'</span>: <span class="st">'aol'</span>, <span class="st">'hotmail.de'</span>: <span class="st">'microsoft'</span>, <span class="st">'centurylink.net'</span>: <span class="st">'centurylink'</span>,</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">'gmail.com'</span>: <span class="st">'google'</span>, <span class="st">'me.com'</span>: <span class="st">'apple'</span>, <span class="st">'earthlink.net'</span>: <span class="st">'other'</span>, <span class="st">'gmx.de'</span>: <span class="st">'other'</span>,</span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">'web.de'</span>: <span class="st">'other'</span>, <span class="st">'cfl.rr.com'</span>: <span class="st">'other'</span>, <span class="st">'hotmail.com'</span>: <span class="st">'microsoft'</span>, </span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">'protonmail.com'</span>: <span class="st">'other'</span>, <span class="st">'hotmail.fr'</span>: <span class="st">'microsoft'</span>, <span class="st">'windstream.net'</span>: <span class="st">'other'</span>, </span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">'outlook.es'</span>: <span class="st">'microsoft'</span>, <span class="st">'yahoo.co.jp'</span>: <span class="st">'yahoo'</span>, <span class="st">'yahoo.de'</span>: <span class="st">'yahoo'</span>,</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>          <span class="st">'servicios-ta.com'</span>: <span class="st">'other'</span>, <span class="st">'netzero.net'</span>: <span class="st">'other'</span>, <span class="st">'suddenlink.net'</span>: <span class="st">'other'</span>,</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>          <span class="st">'roadrunner.com'</span>: <span class="st">'other'</span>, <span class="st">'sc.rr.com'</span>: <span class="st">'other'</span>, <span class="st">'live.fr'</span>: <span class="st">'microsoft'</span>,</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>          <span class="st">'verizon.net'</span>: <span class="st">'yahoo'</span>, <span class="st">'msn.com'</span>: <span class="st">'microsoft'</span>, <span class="st">'q.com'</span>: <span class="st">'centurylink'</span>, </span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>          <span class="st">'prodigy.net.mx'</span>: <span class="st">'att'</span>, <span class="st">'frontier.com'</span>: <span class="st">'yahoo'</span>, <span class="st">'anonymous.com'</span>: <span class="st">'other'</span>, </span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>          <span class="st">'rocketmail.com'</span>: <span class="st">'yahoo'</span>, <span class="st">'sbcglobal.net'</span>: <span class="st">'att'</span>, <span class="st">'frontiernet.net'</span>: <span class="st">'yahoo'</span>, </span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>          <span class="st">'ymail.com'</span>: <span class="st">'yahoo'</span>, <span class="st">'outlook.com'</span>: <span class="st">'microsoft'</span>, <span class="st">'mail.com'</span>: <span class="st">'other'</span>, </span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>          <span class="st">'bellsouth.net'</span>: <span class="st">'other'</span>, <span class="st">'embarqmail.com'</span>: <span class="st">'centurylink'</span>, <span class="st">'cableone.net'</span>: <span class="st">'other'</span>, </span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>          <span class="st">'hotmail.es'</span>: <span class="st">'microsoft'</span>, <span class="st">'mac.com'</span>: <span class="st">'apple'</span>, <span class="st">'yahoo.co.uk'</span>: <span class="st">'yahoo'</span>, <span class="st">'netzero.com'</span>: <span class="st">'other'</span>, </span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>          <span class="st">'yahoo.com'</span>: <span class="st">'yahoo'</span>, <span class="st">'live.com.mx'</span>: <span class="st">'microsoft'</span>, <span class="st">'ptd.net'</span>: <span class="st">'other'</span>, <span class="st">'cox.net'</span>: <span class="st">'other'</span>,</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>          <span class="st">'aol.com'</span>: <span class="st">'aol'</span>, <span class="st">'juno.com'</span>: <span class="st">'other'</span>, <span class="st">'icloud.com'</span>: <span class="st">'apple'</span>, <span class="st">'NAN'</span>:<span class="st">'NAN'</span>}</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>us_emails <span class="op">=</span> [<span class="st">'gmail'</span>, <span class="st">'net'</span>, <span class="st">'edu'</span>]</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.kaggle.com/c/ieee-fraud-detection/discussion/100499#latest-579654</span></span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> [<span class="st">'P_emaildomain'</span>]:</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>    df_trans[c <span class="op">+</span> <span class="st">'_bin'</span>] <span class="op">=</span> df_trans[c].<span class="bu">map</span>(emails)</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>    df_trans[c <span class="op">+</span> <span class="st">'_suffix'</span>] <span class="op">=</span> df_trans[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">str</span>(x).split(<span class="st">'.'</span>)[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#If a suffix matches any of the values in the us_emails list, it's replaced with 'us' to indicate it's a U.S.-based domain. Otherwise, the original suffix remains.</span></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>    df_trans[c <span class="op">+</span> <span class="st">'_suffix'</span>] <span class="op">=</span> df_trans[c <span class="op">+</span> <span class="st">'_suffix'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> <span class="bu">str</span>(x) <span class="kw">not</span> <span class="kw">in</span> us_emails <span class="cf">else</span> <span class="st">'us'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="38">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>ploting_cnt_amt(df_trans, <span class="st">'P_emaildomain_bin'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-39-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="39">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>ploting_cnt_amt(df_trans, <span class="st">'P_emaildomain_suffix'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-40-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="r_email-domain" class="level3">
<h3 class="anchored" data-anchor-id="r_email-domain">R_Email domain</h3>
<ol type="1">
<li>Over 76% are missing value, so let’s exlcude this column from further analysis.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="40">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, [<span class="st">'R_emaildomain'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 401)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="40">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R_emaildomain</td>
      <td>object</td>
      <td>453249</td>
      <td>60</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="41">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_trans, <span class="st">'R_emaildomain'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for R_emaildomain: 76.75%</code></pre>
</div>
</div>
</section>
<section id="c1-c14-d1-d9-m1-m9-vxxx" class="level3">
<h3 class="anchored" data-anchor-id="c1-c14-d1-d9-m1-m9-vxxx">C1-C14, D1-D9, M1-M9, Vxxx</h3>
<p>Given that these features are masked and their meanings are not discernible from their values, to prioritize providing more interpretable insights, let’s exclude them from the subsequent analysis.</p>
</section>
</section>
<section id="eda-id" class="level2">
<h2 class="anchored" data-anchor-id="eda-id">6-2. EDA-id</h2>
<div class="cell" data-tags="[]" data-execution_count="42">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_id, df_id.columns.tolist())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (144233, 41)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="42">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>TransactionID</td>
      <td>int32</td>
      <td>0</td>
      <td>144233</td>
      <td>2987004</td>
      <td>2987008</td>
      <td>2987010</td>
    </tr>
    <tr>
      <th>1</th>
      <td>id_01</td>
      <td>float16</td>
      <td>0</td>
      <td>77</td>
      <td>0.0</td>
      <td>-5.0</td>
      <td>-5.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>id_02</td>
      <td>float32</td>
      <td>3361</td>
      <td>115655</td>
      <td>70787.0</td>
      <td>98945.0</td>
      <td>191631.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>id_03</td>
      <td>float16</td>
      <td>77909</td>
      <td>24</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>id_04</td>
      <td>float16</td>
      <td>77909</td>
      <td>15</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>id_05</td>
      <td>float16</td>
      <td>7368</td>
      <td>93</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>id_06</td>
      <td>float16</td>
      <td>7368</td>
      <td>101</td>
      <td>NaN</td>
      <td>-5.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>id_07</td>
      <td>float16</td>
      <td>139078</td>
      <td>84</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8</th>
      <td>id_08</td>
      <td>float16</td>
      <td>139078</td>
      <td>94</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>id_09</td>
      <td>float16</td>
      <td>69307</td>
      <td>46</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>id_10</td>
      <td>float16</td>
      <td>69307</td>
      <td>62</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>id_11</td>
      <td>float16</td>
      <td>3255</td>
      <td>146</td>
      <td>100.0</td>
      <td>100.0</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>id_12</td>
      <td>object</td>
      <td>0</td>
      <td>2</td>
      <td>NotFound</td>
      <td>NotFound</td>
      <td>NotFound</td>
    </tr>
    <tr>
      <th>13</th>
      <td>id_13</td>
      <td>float16</td>
      <td>16913</td>
      <td>54</td>
      <td>NaN</td>
      <td>49.0</td>
      <td>52.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>id_14</td>
      <td>float16</td>
      <td>64189</td>
      <td>25</td>
      <td>-480.0</td>
      <td>-300.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>15</th>
      <td>id_15</td>
      <td>object</td>
      <td>3248</td>
      <td>3</td>
      <td>New</td>
      <td>New</td>
      <td>Found</td>
    </tr>
    <tr>
      <th>16</th>
      <td>id_16</td>
      <td>object</td>
      <td>14893</td>
      <td>2</td>
      <td>NotFound</td>
      <td>NotFound</td>
      <td>Found</td>
    </tr>
    <tr>
      <th>17</th>
      <td>id_17</td>
      <td>float16</td>
      <td>4864</td>
      <td>104</td>
      <td>166.0</td>
      <td>166.0</td>
      <td>121.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>id_18</td>
      <td>float16</td>
      <td>99120</td>
      <td>18</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>19</th>
      <td>id_19</td>
      <td>float16</td>
      <td>4915</td>
      <td>522</td>
      <td>542.0</td>
      <td>621.0</td>
      <td>410.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>id_20</td>
      <td>float16</td>
      <td>4972</td>
      <td>394</td>
      <td>144.0</td>
      <td>500.0</td>
      <td>142.0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>id_21</td>
      <td>float16</td>
      <td>139074</td>
      <td>490</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>22</th>
      <td>id_22</td>
      <td>float16</td>
      <td>139064</td>
      <td>25</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>23</th>
      <td>id_23</td>
      <td>object</td>
      <td>139064</td>
      <td>3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>24</th>
      <td>id_24</td>
      <td>float16</td>
      <td>139486</td>
      <td>12</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>25</th>
      <td>id_25</td>
      <td>float16</td>
      <td>139101</td>
      <td>341</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>26</th>
      <td>id_26</td>
      <td>float16</td>
      <td>139070</td>
      <td>95</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>27</th>
      <td>id_27</td>
      <td>object</td>
      <td>139064</td>
      <td>2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>28</th>
      <td>id_28</td>
      <td>object</td>
      <td>3255</td>
      <td>2</td>
      <td>New</td>
      <td>New</td>
      <td>Found</td>
    </tr>
    <tr>
      <th>29</th>
      <td>id_29</td>
      <td>object</td>
      <td>3255</td>
      <td>2</td>
      <td>NotFound</td>
      <td>NotFound</td>
      <td>Found</td>
    </tr>
    <tr>
      <th>30</th>
      <td>id_30</td>
      <td>object</td>
      <td>66668</td>
      <td>75</td>
      <td>Android 7.0</td>
      <td>iOS 11.1.2</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>31</th>
      <td>id_31</td>
      <td>object</td>
      <td>3951</td>
      <td>130</td>
      <td>samsung browser 6.2</td>
      <td>mobile safari 11.0</td>
      <td>chrome 62.0</td>
    </tr>
    <tr>
      <th>32</th>
      <td>id_32</td>
      <td>float16</td>
      <td>66647</td>
      <td>4</td>
      <td>32.0</td>
      <td>32.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>33</th>
      <td>id_33</td>
      <td>object</td>
      <td>70944</td>
      <td>260</td>
      <td>2220x1080</td>
      <td>1334x750</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>34</th>
      <td>id_34</td>
      <td>object</td>
      <td>66428</td>
      <td>4</td>
      <td>match_status:2</td>
      <td>match_status:1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>35</th>
      <td>id_35</td>
      <td>object</td>
      <td>3248</td>
      <td>2</td>
      <td>T</td>
      <td>T</td>
      <td>F</td>
    </tr>
    <tr>
      <th>36</th>
      <td>id_36</td>
      <td>object</td>
      <td>3248</td>
      <td>2</td>
      <td>F</td>
      <td>F</td>
      <td>F</td>
    </tr>
    <tr>
      <th>37</th>
      <td>id_37</td>
      <td>object</td>
      <td>3248</td>
      <td>2</td>
      <td>T</td>
      <td>F</td>
      <td>T</td>
    </tr>
    <tr>
      <th>38</th>
      <td>id_38</td>
      <td>object</td>
      <td>3248</td>
      <td>2</td>
      <td>T</td>
      <td>T</td>
      <td>T</td>
    </tr>
    <tr>
      <th>39</th>
      <td>DeviceType</td>
      <td>object</td>
      <td>3423</td>
      <td>2</td>
      <td>mobile</td>
      <td>mobile</td>
      <td>desktop</td>
    </tr>
    <tr>
      <th>40</th>
      <td>DeviceInfo</td>
      <td>object</td>
      <td>25567</td>
      <td>1786</td>
      <td>SAMSUNG SM-G892A Build/NRD90M</td>
      <td>iOS Device</td>
      <td>Windows</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>From the table above, we can select some potentially useful variables including id_30, id_31, DeviceType, DeviceInfo.</p>
<div class="cell" data-execution_count="93">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge two df for better analysis</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>df_merged <span class="op">=</span> df_trans.merge(df_id, on<span class="op">=</span><span class="st">'TransactionID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="id_30" class="level3">
<h3 class="anchored" data-anchor-id="id_30">id_30</h3>
<ol type="1">
<li>This column likely represents operation system.</li>
<li>More than 86% are missing values, so we’ll exclude this variable in the following analysis.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="44">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_merged, [<span class="st">'id_30'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 441)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="44">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id_30</td>
      <td>object</td>
      <td>512975</td>
      <td>75</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="45">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_merged, <span class="st">'id_30'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for id_30: 86.87%</code></pre>
</div>
</div>
</section>
<section id="id_31" class="level3">
<h3 class="anchored" data-anchor-id="id_31">id_31</h3>
<ol type="1">
<li>This column likely represents browser type.</li>
<li>More than 70% are missing values, so we’ll exclude this variable in the following analysis.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="46">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_merged, [<span class="st">'id_31'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 441)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="46">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id_31</td>
      <td>object</td>
      <td>450258</td>
      <td>130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="47">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_merged, <span class="st">'id_31'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for id_31: 76.25%</code></pre>
</div>
</div>
</section>
<section id="devicetype" class="level3">
<h3 class="anchored" data-anchor-id="devicetype">DeviceType</h3>
<ol type="1">
<li>This column contains only two possibilites: desktop and mobile.</li>
<li>More than 70% are missing values, so we’ll exclude this variable in the following analysis.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="48">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_merged, [<span class="st">'DeviceType'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 441)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="48">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>DeviceType</td>
      <td>object</td>
      <td>449730</td>
      <td>2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="49">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_merged, <span class="st">'DeviceType'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for DeviceType: 76.16%</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="50">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>df_merged.DeviceType.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>desktop    85165
mobile     55645
Name: DeviceType, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="deviceinfo" class="level3">
<h3 class="anchored" data-anchor-id="deviceinfo">DeviceInfo</h3>
<ol type="1">
<li>This column also have around 80% missing values, so we’ll also exclude it.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="51">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_merged, [<span class="st">'DeviceInfo'</span>])</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_merged, <span class="st">'DeviceInfo'</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>df_merged.DeviceInfo.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 441)
Missing value percentage for DeviceInfo: 79.91%</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="51">
<pre><code>Windows        47722
iOS Device     19782
MacOS          12573
Trident/7.0     7440
rv:11.0         1901
               ...  
LGMS345            1
verykool           1
XT1072             1
LG-H931            1
0PJA2              1
Name: DeviceInfo, Length: 1786, dtype: int64</code></pre>
</div>
</div>
</section>
</section>
<section id="eda-summary" class="level2">
<h2 class="anchored" data-anchor-id="eda-summary">6-3. EDA Summary</h2>
<p>After reviewing all columns, the following ones are selected for their meaningful content and will be used:</p>
<ul>
<li>Date</li>
<li>_Weekdays</li>
<li>_Hours</li>
<li>_Days</li>
<li>TransactionAmt</li>
<li>Log_TransactionAmt</li>
<li>ProductCD</li>
<li>card4</li>
<li>card6</li>
<li>addr1</li>
<li>P_emaildomain_bin</li>
<li>P_emaildomain_suffix</li>
</ul>
</section>
</section>
<section id="modeling" class="level1">
<h1>7. Modeling</h1>
<section id="select-useful-columns" class="level2">
<h2 class="anchored" data-anchor-id="select-useful-columns">7-1. Select useful columns</h2>
<div class="cell" data-tags="[]" data-execution_count="52">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>selected_columns <span class="op">=</span> [</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'isFraud'</span>,<span class="st">'Date'</span>, <span class="st">'_Weekdays'</span>, <span class="st">'_Hours'</span>, <span class="st">'_Days'</span>,</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TransactionAmt'</span>, <span class="st">'Log_TransactionAmt'</span>, <span class="st">'ProductCD'</span>, <span class="st">'card4'</span>, <span class="st">'card6'</span>,</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'addr1'</span>, <span class="st">'P_emaildomain_bin'</span>, <span class="st">'P_emaildomain_suffix'</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting the specified columns</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> df_merged[selected_columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="53">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_train, df_train.columns.tolist())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 13)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="53">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>isFraud</td>
      <td>int8</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Date</td>
      <td>datetime64[ns]</td>
      <td>0</td>
      <td>573349</td>
      <td>2017-12-02 00:00:00</td>
      <td>2017-12-02 00:00:01</td>
      <td>2017-12-02 00:01:09</td>
    </tr>
    <tr>
      <th>2</th>
      <td>_Weekdays</td>
      <td>int64</td>
      <td>0</td>
      <td>7</td>
      <td>5</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>_Hours</td>
      <td>int64</td>
      <td>0</td>
      <td>24</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>_Days</td>
      <td>int64</td>
      <td>0</td>
      <td>31</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>TransactionAmt</td>
      <td>float64</td>
      <td>0</td>
      <td>8195</td>
      <td>68.5</td>
      <td>29.0</td>
      <td>59.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Log_TransactionAmt</td>
      <td>float64</td>
      <td>0</td>
      <td>8195</td>
      <td>4.241327</td>
      <td>3.401197</td>
      <td>4.094345</td>
    </tr>
    <tr>
      <th>7</th>
      <td>ProductCD</td>
      <td>object</td>
      <td>0</td>
      <td>5</td>
      <td>W</td>
      <td>W</td>
      <td>W</td>
    </tr>
    <tr>
      <th>8</th>
      <td>card4</td>
      <td>object</td>
      <td>0</td>
      <td>5</td>
      <td>discover</td>
      <td>mastercard</td>
      <td>visa</td>
    </tr>
    <tr>
      <th>9</th>
      <td>card6</td>
      <td>object</td>
      <td>0</td>
      <td>5</td>
      <td>credit</td>
      <td>credit</td>
      <td>debit</td>
    </tr>
    <tr>
      <th>10</th>
      <td>addr1</td>
      <td>object</td>
      <td>0</td>
      <td>333</td>
      <td>315.0</td>
      <td>325.0</td>
      <td>330.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>P_emaildomain_bin</td>
      <td>object</td>
      <td>0</td>
      <td>10</td>
      <td>NAN</td>
      <td>google</td>
      <td>microsoft</td>
    </tr>
    <tr>
      <th>12</th>
      <td>P_emaildomain_suffix</td>
      <td>object</td>
      <td>0</td>
      <td>9</td>
      <td>NAN</td>
      <td>com</td>
      <td>com</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression">7-2. Logistic Regression</h2>
<p>Let’s start with a logistic regression as our base line model.</p>
<ol type="1">
<li><p>Change data type from int to object</p>
<ul>
<li>_Weekdays</li>
<li>_Hours</li>
<li>_Days</li>
</ul></li>
<li><p>Group low frequency values of addr1:</p>
<ul>
<li>Avoid overfitting and curse of dimensionality</li>
</ul></li>
<li><p>Set Date to index and sort ascending:</p>
<ul>
<li>for time series data, it’s better to split by time to make sure training data is older than test data, which is different from normal train test split.</li>
</ul></li>
<li><p>One hot encoding:</p>
<ul>
<li>_Weekdays</li>
<li>_Hours</li>
<li>_Days</li>
<li>ProductCD</li>
<li>card4</li>
<li>card6</li>
<li>addr1</li>
<li>P_emaildomain_bin</li>
<li>P_emaildomain_suffix</li>
</ul></li>
<li><p>Standerdization:</p>
<ul>
<li>TransactionAmt</li>
</ul></li>
<li><p>Split data</p></li>
<li><p>How to deal with imbalance dataset? (oversampling techinque discussion):</p>
<ul>
<li>Recall that in EDA of isFraud variable that fraud transactions occur far less frequently compared to non-fraudulent ones. To address this class imbalance, performing oversampling specifically on fraud transactions becomes crucial, allowing us to better capture and train the model on these rare instances.</li>
</ul></li>
<li><p>Overfitting:</p>
<ul>
<li>Using regularization can avoid overfitting problem, but regularization performed on logistic regression with this dataset is not very prominant. We’ll further explore other models that may solve this problem.</li>
</ul></li>
<li><p>Conclusion:</p>
<ul>
<li>The best model’s precision-recall auc is 0.37, which can can capture 63 % of fraud transactions and the prediction precision is 9 %. 24 % of non-fraud transactions are misclassified</li>
</ul></li>
</ol>
<p>1.change data type from int to object</p>
<div class="cell" data-tags="[]" data-execution_count="54">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. change data type from int to object</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>df_train[[<span class="st">'_Weekdays'</span>, <span class="st">'_Hours'</span>, <span class="st">'_Days'</span>]] <span class="op">=</span> df_train[[<span class="st">'_Weekdays'</span>, <span class="st">'_Hours'</span>, <span class="st">'_Days'</span>]].astype(<span class="st">'object'</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>resumetable(df_train, [<span class="st">'_Weekdays'</span>, <span class="st">'_Hours'</span>, <span class="st">'_Days'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 13)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="54">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>_Weekdays</td>
      <td>object</td>
      <td>0</td>
      <td>7</td>
      <td>5</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>1</th>
      <td>_Hours</td>
      <td>object</td>
      <td>0</td>
      <td>24</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>_Days</td>
      <td>object</td>
      <td>0</td>
      <td>31</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>2.Group low frequency values of <code>addr1</code></p>
<div class="cell" data-tags="[]" data-execution_count="55">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Group low frequency (&lt;1%)values of addr1</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> df_train.groupby(<span class="st">'addr1'</span>).size().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>total_count <span class="op">=</span> result.<span class="bu">sum</span>()</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>result_percentage <span class="op">=</span> (result <span class="op">/</span> total_count) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify values with percentages less than 1</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>values_to_group <span class="op">=</span> result_percentage[result_percentage <span class="op">&lt;</span> <span class="dv">1</span>].index.tolist()</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace those values in the DataFrame with the new category 'others'</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>df_train[<span class="st">'addr1'</span>] <span class="op">=</span> df_train[<span class="st">'addr1'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="st">'others'</span> <span class="cf">if</span> x <span class="kw">in</span> values_to_group <span class="cf">else</span> x)</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'reduce unique values of addr1 from 333 to 27'</span>)</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>resumetable(df_train, [<span class="st">'addr1'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>reduce unique values of addr1 from 333 to 27
Dataset Shape: (590540, 13)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="55">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>addr1</td>
      <td>object</td>
      <td>0</td>
      <td>27</td>
      <td>315.0</td>
      <td>325.0</td>
      <td>330.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>3.set <code>Date</code> to index and sort ascending</p>
<div class="cell" data-tags="[]" data-execution_count="56">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.set Date to index and sort ascending</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>df_train.set_index(<span class="st">'Date'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>df_train.sort_index(ascending<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>4.One hot encoding</p>
<div class="cell" data-tags="[]" data-execution_count="57">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4.One hot encoding</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting into features and target variable</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_train.drop(<span class="st">'isFraud'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_train[<span class="st">'isFraud'</span>]</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co"># List of categorical columns for one hot encoding</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>columns_to_encode <span class="op">=</span> [<span class="st">'_Weekdays'</span>, <span class="st">'_Hours'</span>, <span class="st">'_Days'</span>, <span class="st">'ProductCD'</span>, <span class="st">'card4'</span>, <span class="st">'card6'</span>,<span class="st">'addr1'</span>, <span class="st">'P_emaildomain_bin'</span>, <span class="st">'P_emaildomain_suffix'</span>]</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>X_transformed <span class="op">=</span> pd.get_dummies(X, columns<span class="op">=</span>columns_to_encode, prefix<span class="op">=</span>columns_to_encode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>5.Standerdization</p>
<div class="cell" data-tags="[]" data-execution_count="58">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#5. Standerdization:</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>columns_to_standerdize <span class="op">=</span> [<span class="st">'TransactionAmt'</span>]</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize the StandardScaler</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit and transform the scaler on your numeric data</span></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scaler.fit_transform(X[columns_to_standerdize])</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a><span class="co"># replcae with original TransactionAmt</span></span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>X_transformed[<span class="st">'TransactionAmt'</span>] <span class="op">=</span> X_scaled</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="59">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>X_transformed.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="59">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>TransactionAmt</th>
      <th>Log_TransactionAmt</th>
      <th>_Weekdays_0</th>
      <th>_Weekdays_1</th>
      <th>_Weekdays_2</th>
      <th>_Weekdays_3</th>
      <th>_Weekdays_4</th>
      <th>_Weekdays_5</th>
      <th>_Weekdays_6</th>
      <th>_Hours_0</th>
      <th>...</th>
      <th>P_emaildomain_bin_yahoo</th>
      <th>P_emaildomain_suffix_NAN</th>
      <th>P_emaildomain_suffix_com</th>
      <th>P_emaildomain_suffix_de</th>
      <th>P_emaildomain_suffix_es</th>
      <th>P_emaildomain_suffix_fr</th>
      <th>P_emaildomain_suffix_jp</th>
      <th>P_emaildomain_suffix_mx</th>
      <th>P_emaildomain_suffix_uk</th>
      <th>P_emaildomain_suffix_us</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2017-12-02 00:00:00</th>
      <td>-0.278174</td>
      <td>4.241327</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2017-12-02 00:00:01</th>
      <td>-0.443337</td>
      <td>3.401197</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2017-12-02 00:01:09</th>
      <td>-0.317897</td>
      <td>4.094345</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>3 rows × 125 columns</p>
</div>
</div>
</div>
<p>6.Split data</p>
<div class="cell" data-tags="[]" data-execution_count="60">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">#6. Split data</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the range of dates</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>min_date <span class="op">=</span> X_transformed.index.<span class="bu">min</span>()</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>max_date <span class="op">=</span> X_transformed.index.<span class="bu">max</span>()</span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Minimum date: </span><span class="sc">{</span>min_date<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Maximum date: </span><span class="sc">{</span>max_date<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Minimum date: 2017-12-02 00:00:00
Maximum date: 2018-06-01 23:58:51</code></pre>
</div>
</div>
<p>The date range spans approximately 6 months. Given that it’s a time series dataset, it’s more appropriate to partition it based on dates rather than employing the conventional train-test split. Let’s use the first 5 months as training data and the last month as testing data.</p>
<div class="cell" data-tags="[]" data-execution_count="61">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>train_date <span class="op">=</span> <span class="st">'2018-04-30'</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>test_date <span class="op">=</span> <span class="st">'2018-05-01'</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>x_train, y_train <span class="op">=</span> X_transformed.loc[:train_date], y.loc[:train_date]</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>x_test, y_test <span class="op">=</span> X_transformed.loc[test_date:], y.loc[test_date:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>7.How to deal with imbalance dataset? (oversampling techinque discussion)</p>
<p>Recall that in our EDA “isFraud” section, it was observed that only 3.5% of records were labeled as ‘fraud.’ This class imbalance poses a challenge for model performance, as the model may struggle to capture the characteristics of fraudulent records effectively. Consequently, employing oversampling techniques becomes crucial to augment the number of fraud transactions, enhancing the model’s ability for more effective modeling.</p>
<p>Let’s start by building the model without oversampling.</p>
<div class="cell" data-tags="[]" data-execution_count="62">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. Perform logistic regression</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>logreg <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using the training data</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>logreg.fit(x_train, y_train)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the train data</span></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>x_train_pred <span class="op">=</span> logreg.predict(x_train)</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the test data</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> logreg.predict(x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="63">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co">#show performance</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"(Without Oversampling): Show performance on training data..."</span>)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>evaluate_results(y_train, x_train_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Without Oversampling): Show performance on training data...
F1 Score: 0.005022257733135487
Confusion Matrix:
[[480635     28]
 [ 17406     44]]
Precision is 61 %; Recall is 0 %
PR-RC AUC: 0.32428823963938536</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-65-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Can capture 0 % of fraud transactions and the prediction precision is 61 %. 0 % of non-fraud transactions are misclassified</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="64">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co">#show performance</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"(Without Oversampling): Show performance on testing data..."</span>)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>evaluate_results(y_test, y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Without Oversampling): Show performance on testing data...
F1 Score: 0.0037243947858473002
Confusion Matrix:
[[89211     3]
 [ 3207     6]]
Precision is 67 %; Recall is 0 %
PR-RC AUC: 0.35161586679095885</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-66-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Can capture 0 % of fraud transactions and the prediction precision is 67 %. 0 % of non-fraud transactions are misclassified</code></pre>
</div>
</div>
<p>Without oversampling PR-RC-AUC: - Training data: 0.32 - Testing data: 0.35</p>
<p>Now let’s perform oversampling and observe the changes.</p>
<div class="cell" data-tags="[]" data-execution_count="65">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co">#7. Perform oversampling to solve imbalance problem</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.kaggle.com/code/shahules/tackling-class-imbalance</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>pd.concat([x_train,y_train],axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>not_fraud<span class="op">=</span>X[X.isFraud<span class="op">==</span><span class="dv">0</span>]</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>fraud<span class="op">=</span>X[X.isFraud<span class="op">==</span><span class="dv">1</span>]</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a><span class="co"># upsample minority</span></span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a>fraud_upsampled <span class="op">=</span> resample(fraud,</span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>                          replace<span class="op">=</span><span class="va">True</span>, <span class="co"># sample with replacement</span></span>
<span id="cb103-12"><a href="#cb103-12" aria-hidden="true" tabindex="-1"></a>                          n_samples<span class="op">=</span><span class="bu">len</span>(not_fraud), <span class="co"># match number in majority class</span></span>
<span id="cb103-13"><a href="#cb103-13" aria-hidden="true" tabindex="-1"></a>                          random_state<span class="op">=</span><span class="dv">27</span>) <span class="co"># reproducible results</span></span>
<span id="cb103-14"><a href="#cb103-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-15"><a href="#cb103-15" aria-hidden="true" tabindex="-1"></a><span class="co"># combine majority and upsampled minority</span></span>
<span id="cb103-16"><a href="#cb103-16" aria-hidden="true" tabindex="-1"></a>upsampled <span class="op">=</span> pd.concat([not_fraud, fraud_upsampled])</span>
<span id="cb103-17"><a href="#cb103-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-18"><a href="#cb103-18" aria-hidden="true" tabindex="-1"></a><span class="co"># replace original x_train, y_train</span></span>
<span id="cb103-19"><a href="#cb103-19" aria-hidden="true" tabindex="-1"></a>x_train <span class="op">=</span> upsampled.drop(<span class="st">'isFraud'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb103-20"><a href="#cb103-20" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> upsampled[<span class="st">'isFraud'</span>]</span>
<span id="cb103-21"><a href="#cb103-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-22"><a href="#cb103-22" aria-hidden="true" tabindex="-1"></a><span class="co"># check new class counts</span></span>
<span id="cb103-23"><a href="#cb103-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"check new class counts"</span>)</span>
<span id="cb103-24"><a href="#cb103-24" aria-hidden="true" tabindex="-1"></a>upsampled.isFraud.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>check new class counts</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="65">
<pre><code>0    480663
1    480663
Name: isFraud, dtype: int64</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="66">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. Perform logistic regression</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>logreg <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using the training data</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>logreg.fit(x_train, y_train)</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the train data</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>x_train_pred <span class="op">=</span> logreg.predict(x_train)</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the test data</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> logreg.predict(x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="67">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co">#show performance</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"(With Oversampling): Show performance on training data..."</span>)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>evaluate_results(y_train, x_train_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(With Oversampling): Show performance on training data...
F1 Score: 0.6837879685114658
Confusion Matrix:
[[355648 125015]
 [166006 314657]]
Precision is 72 %; Recall is 65 %
PR-RC AUC: 0.7714893216881513</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-69-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Can capture 65 % of fraud transactions and the prediction precision is 72 %. 26 % of non-fraud transactions are misclassified</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="68">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co">#show performance</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"(With Oversampling): Show performance on testing data..."</span>)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>evaluate_results(y_test, y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(With Oversampling): Show performance on testing data...
F1 Score: 0.15101787215379556
Confusion Matrix:
[[67132 22082]
 [ 1147  2066]]
Precision is 9 %; Recall is 64 %
PR-RC AUC: 0.37048914697029617</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-70-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Can capture 64 % of fraud transactions and the prediction precision is 9 %. 25 % of non-fraud transactions are misclassified</code></pre>
</div>
</div>
<p>With oversampling PR-RC-AUC: - Training data: 0.77 - Testing data: 0.37</p>
<p>With oversampling, training data’s PR-RC-AUC increases from 0.32 to 0.77 and testing data’s PR-RC-AUC increases from 0.35 to 0.37. This shows the oversampling technique help the model to better capture characteristics of fraudulent transactions.</p>
<ol start="8" type="1">
<li>Solve overfitting</li>
</ol>
<p>The Precision-Recall Area Under the Curve (PR-RC-AUC) for the testing data is lower at 0.37 compared to the training data’s higher PR-RC-AUC of 0.77. This discrepancy suggests the presence of an overfitting problem. To address this issue, let’s implement some regularization techniques.</p>
<div class="cell" data-tags="[]" data-execution_count="69">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Standardization is often recommended when using regularization.</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>x_train_scaled <span class="op">=</span> scaler.fit_transform(x_train)</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>x_test_scaled <span class="op">=</span> scaler.transform(x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-tags="[]" data-execution_count="70">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. Perform logistic regression</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>logreg <span class="op">=</span> LogisticRegression(random_state<span class="op">=</span><span class="dv">42</span>, C<span class="op">=</span><span class="fl">0.00001</span>)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Train the model using the training data</span></span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a>logreg.fit(x_train_scaled, y_train)</span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the train data</span></span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>x_train_pred <span class="op">=</span> logreg.predict(x_train_scaled)</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the test data</span></span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> logreg.predict(x_test_scaled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="71">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co">#show performance</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>evaluate_results(y_train, x_train_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>F1 Score: 0.6758616444559736
Confusion Matrix:
[[358994 121669]
 [173223 307440]]
Precision is 72 %; Recall is 64 %
PR-RC AUC: 0.768134791760063</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-73-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Can capture 64 % of fraud transactions and the prediction precision is 72 %. 25 % of non-fraud transactions are misclassified</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="72">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">#show performance</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>evaluate_results(y_test, y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>F1 Score: 0.1540732889158086
Confusion Matrix:
[[68046 21168]
 [ 1178  2035]]
Precision is 9 %; Recall is 63 %
PR-RC AUC: 0.3669069132910227</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-74-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Can capture 63 % of fraud transactions and the prediction precision is 9 %. 24 % of non-fraud transactions are misclassified</code></pre>
</div>
</div>
<p>Regularization performed on logistic regression is not very prominant. Let’s further explore other models that may solve this problem.</p>
</section>
<section id="decision-tree" class="level2">
<h2 class="anchored" data-anchor-id="decision-tree">7-3. Decision Tree</h2>
<ol type="1">
<li><p>Change data type from int to object</p>
<ul>
<li>_Weekdays</li>
<li>_Hours</li>
<li>_Days</li>
</ul></li>
<li><p>Group low frequency values of addr1:</p>
<ul>
<li>Avoid overfitting and curse of dimensionality</li>
</ul></li>
<li><p>Set Date to index and sort ascending:</p>
<ul>
<li>for time series data, it’s better to split by time to make sure training data is older than test data, which is different from normal train test split.</li>
</ul></li>
<li><p>One hot encoding: Decision Tree is able to handle both numerical and categorical data. However, the scikit-learn implementation does not support categorical variables for now.</p>
<ul>
<li>_Weekdays</li>
<li>_Hours</li>
<li>_Days</li>
<li>ProductCD</li>
<li>card4</li>
<li>card6</li>
<li>addr1</li>
<li>P_emaildomain_bin</li>
<li>P_emaildomain_suffix</li>
</ul></li>
<li><p>Standerdization:</p>
<ul>
<li>TransactionAmt</li>
</ul></li>
<li><p>Split data</p></li>
<li><p>Perform oversampling to solve imbalance problem:</p>
<ul>
<li>Recall that in EDA of isFraud variable that fraud transactions occur far less frequently compared to non-fraudulent ones. To address this class imbalance, performing oversampling specifically on fraud transactions becomes crucial, allowing us to better capture and train the model on these rare instances.</li>
</ul></li>
<li><p>Perform deicision tree</p></li>
<li><p>Evaluate Results:</p>
<ul>
<li>Confusion Matrix</li>
<li>F1-score</li>
<li>Recall-Precision curve AUC</li>
</ul></li>
<li><p>Conclusion:</p>
<ul>
<li>The best model’s precision-recall auc is 0.36, which can capture 62 % of fraud transactions and the prediction precision is 8 %. 26 % of non-fraud transactions are misclassified</li>
</ul></li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="73">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting the specified columns</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> df_merged[selected_columns]</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. change data type from int to object</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>df_train[[<span class="st">'_Weekdays'</span>, <span class="st">'_Hours'</span>, <span class="st">'_Days'</span>]] <span class="op">=</span> df_train[[<span class="st">'_Weekdays'</span>, <span class="st">'_Hours'</span>, <span class="st">'_Days'</span>]].astype(<span class="st">'object'</span>)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Group low frequency values of addr1</span></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> group_low_percentage_values(df_train, <span class="st">'addr1'</span>, threshold<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Set Date to index and sort ascending</span></span>
<span id="cb121-10"><a href="#cb121-10" aria-hidden="true" tabindex="-1"></a>df_train.set_index(<span class="st">'Date'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb121-11"><a href="#cb121-11" aria-hidden="true" tabindex="-1"></a>df_train.sort_index(ascending<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb121-12"><a href="#cb121-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-13"><a href="#cb121-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting into features and target variable</span></span>
<span id="cb121-14"><a href="#cb121-14" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_train.drop(<span class="st">'isFraud'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb121-15"><a href="#cb121-15" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_train[<span class="st">'isFraud'</span>]</span>
<span id="cb121-16"><a href="#cb121-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-17"><a href="#cb121-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. One hot encoding</span></span>
<span id="cb121-18"><a href="#cb121-18" aria-hidden="true" tabindex="-1"></a>columns_to_encode <span class="op">=</span> [<span class="st">'_Weekdays'</span>, <span class="st">'_Hours'</span>, <span class="st">'_Days'</span>, <span class="st">'ProductCD'</span>, <span class="st">'card4'</span>, <span class="st">'card6'</span>,<span class="st">'addr1'</span>, <span class="st">'P_emaildomain_bin'</span>, <span class="st">'P_emaildomain_suffix'</span>]</span>
<span id="cb121-19"><a href="#cb121-19" aria-hidden="true" tabindex="-1"></a>X_transformed <span class="op">=</span> pd.get_dummies(X, columns<span class="op">=</span>columns_to_encode, prefix<span class="op">=</span>columns_to_encode)</span>
<span id="cb121-20"><a href="#cb121-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-21"><a href="#cb121-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Standerdization</span></span>
<span id="cb121-22"><a href="#cb121-22" aria-hidden="true" tabindex="-1"></a>columns_to_standerdize <span class="op">=</span> [<span class="st">'TransactionAmt'</span>]</span>
<span id="cb121-23"><a href="#cb121-23" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb121-24"><a href="#cb121-24" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scaler.fit_transform(X[columns_to_standerdize])</span>
<span id="cb121-25"><a href="#cb121-25" aria-hidden="true" tabindex="-1"></a>X_transformed[<span class="st">'TransactionAmt'</span>] <span class="op">=</span> X_scaled</span>
<span id="cb121-26"><a href="#cb121-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-27"><a href="#cb121-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Split data</span></span>
<span id="cb121-28"><a href="#cb121-28" aria-hidden="true" tabindex="-1"></a>train_date <span class="op">=</span> <span class="st">'2018-04-30'</span></span>
<span id="cb121-29"><a href="#cb121-29" aria-hidden="true" tabindex="-1"></a>test_date <span class="op">=</span> <span class="st">'2018-05-01'</span></span>
<span id="cb121-30"><a href="#cb121-30" aria-hidden="true" tabindex="-1"></a>x_train, y_train, x_test, y_test <span class="op">=</span> split_data_by_date(X_transformed, y, train_date, test_date)</span>
<span id="cb121-31"><a href="#cb121-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-32"><a href="#cb121-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. oversampling</span></span>
<span id="cb121-33"><a href="#cb121-33" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>pd.concat([x_train,y_train],axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb121-34"><a href="#cb121-34" aria-hidden="true" tabindex="-1"></a>upsampled_data <span class="op">=</span> upsample_minority_class(X)</span>
<span id="cb121-35"><a href="#cb121-35" aria-hidden="true" tabindex="-1"></a>x_train <span class="op">=</span> upsampled.drop(<span class="st">'isFraud'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb121-36"><a href="#cb121-36" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> upsampled[<span class="st">'isFraud'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="74">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co">#8. Decision Tree</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1% of total values</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>threshold <span class="op">=</span> <span class="bu">round</span>(x_train.shape[<span class="dv">0</span>]<span class="op">*</span><span class="fl">0.001</span>)</span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create Decision Tree classifer object</span></span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> DecisionTreeClassifier(max_depth<span class="op">=</span><span class="dv">20</span>, min_samples_split<span class="op">=</span>threshold, min_samples_leaf <span class="op">=</span> threshold, random_state<span class="op">=</span><span class="dv">42</span>)</span>
<span id="cb122-8"><a href="#cb122-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-9"><a href="#cb122-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Train Decision Tree Classifer</span></span>
<span id="cb122-10"><a href="#cb122-10" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> clf.fit(x_train,y_train)</span>
<span id="cb122-11"><a href="#cb122-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb122-12"><a href="#cb122-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the train data</span></span>
<span id="cb122-13"><a href="#cb122-13" aria-hidden="true" tabindex="-1"></a>x_train_pred <span class="op">=</span> clf.predict(x_train)</span>
<span id="cb122-14"><a href="#cb122-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on the test data</span></span>
<span id="cb122-15"><a href="#cb122-15" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> clf.predict(x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="75">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>evaluate_results(y_train, x_train_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>F1 Score: 0.7293538142181031
Confusion Matrix:
[[368797 111866]
 [140550 340113]]
Precision is 75 %; Recall is 71 %
PR-RC AUC: 0.8031465226186614</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-78-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Can capture 71 % of fraud transactions and the prediction precision is 75 %. 23 % of non-fraud transactions are misclassified</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="76">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>evaluate_results(y_test, y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>F1 Score: 0.15381615381615382
Confusion Matrix:
[[68758 20456]
 [ 1241  1972]]
Precision is 9 %; Recall is 61 %
PR-RC AUC: 0.35755461664752</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-79-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Can capture 61 % of fraud transactions and the prediction precision is 9 %. 23 % of non-fraud transactions are misclassified</code></pre>
</div>
</div>
</section>
<section id="xgboost" class="level2">
<h2 class="anchored" data-anchor-id="xgboost">7-4. XGBoost</h2>
<ol type="1">
<li><p>Change data type from int to object</p>
<ul>
<li>_Weekdays</li>
<li>_Hours</li>
<li>_Days</li>
</ul></li>
<li><p>Group low frequency values of addr1:</p>
<ul>
<li>Avoid overfitting and curse of dimensionality</li>
</ul></li>
<li><p>Set Date to index and sort ascending:</p>
<ul>
<li>for time series data, it’s better to split by time to make sure training data is older than test data, which is different from normal train test split.</li>
</ul></li>
<li><p>One hot encoding:</p>
<ul>
<li>_Weekdays</li>
<li>_Hours</li>
<li>_Days</li>
<li>ProductCD</li>
<li>card4</li>
<li>card6</li>
<li>addr1</li>
<li>P_emaildomain_bin</li>
<li>P_emaildomain_suffix</li>
</ul></li>
<li><p>Standerdization:</p>
<ul>
<li>TransactionAmt</li>
</ul></li>
<li><p>Split data</p></li>
<li><p>Perform oversampling to solve imbalance problem:</p>
<ul>
<li>Recall that in EDA of isFraud variable that fraud transactions occur far less frequently compared to non-fraudulent ones. To address this class imbalance, performing oversampling specifically on fraud transactions becomes crucial, allowing us to better capture and train the model on these rare instances.</li>
</ul></li>
<li><p>Perform XGBoost</p></li>
<li><p>Evaluate Results:</p>
<ul>
<li>Confusion Matrix</li>
<li>F1-score</li>
<li>Recall-Precision curve AUC</li>
</ul></li>
<li><p>Conclusion:</p>
<ul>
<li>The best model’s precision-recall auc is 0.36, which can capture 59 % of fraud transactions and the prediction precision is 11 %. 17 % of non-fraud transactions are misclassified.</li>
</ul></li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="94">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting the specified columns</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> df_merged[selected_columns]</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. change data type from int to object</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>df_train[[<span class="st">'_Weekdays'</span>, <span class="st">'_Hours'</span>, <span class="st">'_Days'</span>]] <span class="op">=</span> df_train[[<span class="st">'_Weekdays'</span>, <span class="st">'_Hours'</span>, <span class="st">'_Days'</span>]].astype(<span class="st">'object'</span>)</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Group low frequency values of addr1</span></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> group_low_percentage_values(df_train, <span class="st">'addr1'</span>, threshold<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Set Date to index and sort ascending</span></span>
<span id="cb129-10"><a href="#cb129-10" aria-hidden="true" tabindex="-1"></a>df_train.set_index(<span class="st">'Date'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb129-11"><a href="#cb129-11" aria-hidden="true" tabindex="-1"></a>df_train.sort_index(ascending<span class="op">=</span><span class="va">True</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb129-12"><a href="#cb129-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-13"><a href="#cb129-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting into features and target variable</span></span>
<span id="cb129-14"><a href="#cb129-14" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> df_train.drop(<span class="st">'isFraud'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb129-15"><a href="#cb129-15" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> df_train[<span class="st">'isFraud'</span>]</span>
<span id="cb129-16"><a href="#cb129-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-17"><a href="#cb129-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. One hot encoding</span></span>
<span id="cb129-18"><a href="#cb129-18" aria-hidden="true" tabindex="-1"></a>columns_to_encode <span class="op">=</span> [<span class="st">'_Weekdays'</span>, <span class="st">'_Hours'</span>, <span class="st">'_Days'</span>, <span class="st">'ProductCD'</span>, <span class="st">'card4'</span>, <span class="st">'card6'</span>,<span class="st">'addr1'</span>, <span class="st">'P_emaildomain_bin'</span>, <span class="st">'P_emaildomain_suffix'</span>]</span>
<span id="cb129-19"><a href="#cb129-19" aria-hidden="true" tabindex="-1"></a>X_transformed <span class="op">=</span> pd.get_dummies(X, columns<span class="op">=</span>columns_to_encode, prefix<span class="op">=</span>columns_to_encode)</span>
<span id="cb129-20"><a href="#cb129-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-21"><a href="#cb129-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Standerdization</span></span>
<span id="cb129-22"><a href="#cb129-22" aria-hidden="true" tabindex="-1"></a>columns_to_standerdize <span class="op">=</span> [<span class="st">'TransactionAmt'</span>]</span>
<span id="cb129-23"><a href="#cb129-23" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb129-24"><a href="#cb129-24" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scaler.fit_transform(X[columns_to_standerdize])</span>
<span id="cb129-25"><a href="#cb129-25" aria-hidden="true" tabindex="-1"></a>X_transformed[<span class="st">'TransactionAmt'</span>] <span class="op">=</span> X_scaled</span>
<span id="cb129-26"><a href="#cb129-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-27"><a href="#cb129-27" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Split data</span></span>
<span id="cb129-28"><a href="#cb129-28" aria-hidden="true" tabindex="-1"></a>train_date <span class="op">=</span> <span class="st">'2018-04-30'</span></span>
<span id="cb129-29"><a href="#cb129-29" aria-hidden="true" tabindex="-1"></a>test_date <span class="op">=</span> <span class="st">'2018-05-01'</span></span>
<span id="cb129-30"><a href="#cb129-30" aria-hidden="true" tabindex="-1"></a>x_train, y_train, x_test, y_test <span class="op">=</span> split_data_by_date(X_transformed, y, train_date, test_date)</span>
<span id="cb129-31"><a href="#cb129-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-32"><a href="#cb129-32" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. oversampling</span></span>
<span id="cb129-33"><a href="#cb129-33" aria-hidden="true" tabindex="-1"></a>X<span class="op">=</span>pd.concat([x_train,y_train],axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb129-34"><a href="#cb129-34" aria-hidden="true" tabindex="-1"></a>upsampled_data <span class="op">=</span> upsample_minority_class(X)</span>
<span id="cb129-35"><a href="#cb129-35" aria-hidden="true" tabindex="-1"></a>x_train <span class="op">=</span> upsampled.drop(<span class="st">'isFraud'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb129-36"><a href="#cb129-36" aria-hidden="true" tabindex="-1"></a>y_train <span class="op">=</span> upsampled[<span class="st">'isFraud'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="78">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="co">#8. Decision Tree</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create XGBClassifier</span></span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> xgb.XGBClassifier(</span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>            n_estimators<span class="op">=</span><span class="dv">100</span>, random_state<span class="op">=</span><span class="dv">4</span>, verbose<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>            tree_method<span class="op">=</span><span class="st">'gpu_hist'</span>,objective<span class="op">=</span><span class="st">'binary:logistic'</span>, max_depth<span class="op">=</span><span class="dv">10</span>, learning_rate<span class="op">=</span><span class="fl">0.02</span>, </span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a>            subsample<span class="op">=</span><span class="fl">0.8</span>, colsample_bytree<span class="op">=</span><span class="fl">0.4</span>, eval_metric<span class="op">=</span><span class="st">'aucpr'</span></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Train Decision Tree Classifer</span></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a>clf <span class="op">=</span> clf.fit(x_train,y_train)</span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-12"><a href="#cb130-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Predict the response for test dataset</span></span>
<span id="cb130-13"><a href="#cb130-13" aria-hidden="true" tabindex="-1"></a>x_train_pred <span class="op">=</span> clf.predict(x_train)</span>
<span id="cb130-14"><a href="#cb130-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Predict the response for test dataset</span></span>
<span id="cb130-15"><a href="#cb130-15" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> clf.predict(x_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="79">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>evaluate_results(y_train, x_train_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>F1 Score: 0.7630705589039241
Confusion Matrix:
[[394996  85667]
 [131290 349373]]
Precision is 80 %; Recall is 73 %
PR-RC AUC: 0.8332553491374364</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-82-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Can capture 73 % of fraud transactions and the prediction precision is 80 %. 18 % of non-fraud transactions are misclassified</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="80">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>evaluate_results(y_test, y_pred)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>F1 Score: 0.1855419342284491
Confusion Matrix:
[[73778 15436]
 [ 1306  1907]]
Precision is 11 %; Recall is 59 %
PR-RC AUC: 0.35880713885797433</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection_files/figure-html/cell-83-output-2.png" class="img-fluid"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Can capture 59 % of fraud transactions and the prediction precision is 11 %. 17 % of non-fraud transactions are misclassified</code></pre>
</div>
</div>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">7-5. Conclusion</h2>
<p>Until now, we have experimented with three models (logistic regression, decision tree, xgboost); however, there has been no significant improvement in results. I suspect that the lack of improvement may not be due to the models’ capabilities but rather a result of not utilizing the most informative features. The excluded features, such as C, D, M, and V, may contain some useful information, but their true meaning were not provided which give no meaningful insights. Therefore, we will not delve deeper into analyzing these features.</p>
</section>
</section>
<section id="conclusion-1" class="level1">
<h1>8. Conclusion</h1>
<p>In this project, we discuss about several topics:</p>
<ul>
<li><p>Selection between ROC Curve and Precision-Recall Curve</p></li>
<li><p>Features EDA</p></li>
<li><p>Oversampling Technique</p></li>
<li><p>Logistic Regression/ Decision Tree/ XGboost</p></li>
</ul>
<p>The best model achieves a PR-RC AUC of 0.83 on the training data but only 0.37 on the testing data. This discrepancy does not stem from overfitting but rather from a deficiency in powerful predictive features. Specifically, certain features (C, D, M, and V) lack explicit meanings, hindering their ability to contribute meaningfully to the model’s predictions.</p>
<p>Despite these challenges, the project remains fruitful, showcasing the application of various techniques and methodologies.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>