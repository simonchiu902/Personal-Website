<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.163">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Simon Chiu">
<meta name="dcterms.date" content="2024-01-09">

<title>Simon Chiu - Fraud Detection</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Simon Chiu</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-data-analytics-projects" role="button" data-bs-toggle="dropdown" aria-expanded="false">Data Analytics Projects</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-data-analytics-projects">    
        <li>
    <a class="dropdown-item" href="../../Data_Analytics_Projects/Population Visual Analysis/Population_Visual_Analysis.html">
 <span class="dropdown-text">Population Visual Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Data_Analytics_Projects/Fraud Detection/Fraud_Detection.html">
 <span class="dropdown-text">Fruad Detection</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-quarto-tutorial-articles" role="button" data-bs-toggle="dropdown" aria-expanded="false">Quarto Tutorial Articles</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-quarto-tutorial-articles">    
        <li>
    <a class="dropdown-item" href="../../Quarto_tutorial_articles/Quarto_Article1/Quarto_Article1.html">
 <span class="dropdown-text">How to build a Quarto website</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../Quarto_tutorial_articles/Quarto_Article2/Quarto_Article2.html">
 <span class="dropdown-text">Custom Quarto Website</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/simonchiu902/Personal-Website"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/shih-cheng-chiu-simon-183906163/"><i class="bi bi-linkedin" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">Home</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#tasks" id="toc-tasks" class="nav-link active" data-scroll-target="#tasks">1. Tasks</a>
  <ul class="collapse">
  <li><a href="#roc-curve" id="toc-roc-curve" class="nav-link" data-scroll-target="#roc-curve">ROC Curve</a></li>
  <li><a href="#precision-recall-curve" id="toc-precision-recall-curve" class="nav-link" data-scroll-target="#precision-recall-curve">Precision-Recall Curve</a></li>
  </ul></li>
  <li><a href="#import-packages" id="toc-import-packages" class="nav-link" data-scroll-target="#import-packages">2. Import Packages</a></li>
  <li><a href="#predefined-functions" id="toc-predefined-functions" class="nav-link" data-scroll-target="#predefined-functions">3. Predefined Functions</a></li>
  <li><a href="#read-data" id="toc-read-data" class="nav-link" data-scroll-target="#read-data">4. Read Data</a></li>
  <li><a href="#columns-descriptions" id="toc-columns-descriptions" class="nav-link" data-scroll-target="#columns-descriptions">5. Columns Descriptions</a></li>
  <li><a href="#eda" id="toc-eda" class="nav-link" data-scroll-target="#eda">6. EDA</a>
  <ul class="collapse">
  <li><a href="#eda-transaction" id="toc-eda-transaction" class="nav-link" data-scroll-target="#eda-transaction">6-1. EDA-Transaction</a>
  <ul class="collapse">
  <li><a href="#transactionid" id="toc-transactionid" class="nav-link" data-scroll-target="#transactionid">TransactionID</a></li>
  <li><a href="#isfraud" id="toc-isfraud" class="nav-link" data-scroll-target="#isfraud">isFraud</a></li>
  <li><a href="#transactiondt" id="toc-transactiondt" class="nav-link" data-scroll-target="#transactiondt">TransactionDT</a></li>
  <li><a href="#transactionamt" id="toc-transactionamt" class="nav-link" data-scroll-target="#transactionamt">TransactionAmt</a></li>
  <li><a href="#isfraud-transactiondt-transactionamt" id="toc-isfraud-transactiondt-transactionamt" class="nav-link" data-scroll-target="#isfraud-transactiondt-transactionamt">isFraud &amp; TransactionDT &amp; TransactionAmt</a></li>
  <li><a href="#isfraud-transactiondt-productcd" id="toc-isfraud-transactiondt-productcd" class="nav-link" data-scroll-target="#isfraud-transactiondt-productcd">isFraud &amp; TransactionDT &amp; ProductCD</a></li>
  <li><a href="#card1-6" id="toc-card1-6" class="nav-link" data-scroll-target="#card1-6">Card1-6</a></li>
  <li><a href="#address" id="toc-address" class="nav-link" data-scroll-target="#address">address</a></li>
  <li><a href="#p_email-domain" id="toc-p_email-domain" class="nav-link" data-scroll-target="#p_email-domain">P_Email domain</a></li>
  <li><a href="#r_email-domain" id="toc-r_email-domain" class="nav-link" data-scroll-target="#r_email-domain">R_Email domain</a></li>
  <li><a href="#c1-c14-d1-d9-m1-m9-vxxx" id="toc-c1-c14-d1-d9-m1-m9-vxxx" class="nav-link" data-scroll-target="#c1-c14-d1-d9-m1-m9-vxxx">C1-C14, D1-D9, M1-M9, Vxxx</a></li>
  </ul></li>
  <li><a href="#eda-id" id="toc-eda-id" class="nav-link" data-scroll-target="#eda-id">6-2. EDA-id</a>
  <ul class="collapse">
  <li><a href="#id_30" id="toc-id_30" class="nav-link" data-scroll-target="#id_30">id_30</a></li>
  <li><a href="#id_31" id="toc-id_31" class="nav-link" data-scroll-target="#id_31">id_31</a></li>
  <li><a href="#devicetype" id="toc-devicetype" class="nav-link" data-scroll-target="#devicetype">DeviceType</a></li>
  <li><a href="#deviceinfo" id="toc-deviceinfo" class="nav-link" data-scroll-target="#deviceinfo">DeviceInfo</a></li>
  </ul></li>
  <li><a href="#eda-summary" id="toc-eda-summary" class="nav-link" data-scroll-target="#eda-summary">6-3. EDA Summary</a></li>
  </ul></li>
  <li><a href="#preprocessing" id="toc-preprocessing" class="nav-link" data-scroll-target="#preprocessing">7. Preprocessing</a>
  <ul class="collapse">
  <li><a href="#select-useful-columns" id="toc-select-useful-columns" class="nav-link" data-scroll-target="#select-useful-columns">7-1. Select useful columns</a></li>
  <li><a href="#preprocessing-1" id="toc-preprocessing-1" class="nav-link" data-scroll-target="#preprocessing-1">7-2. Preprocessing</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Fraud Detection</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Simon Chiu </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 9, 2024</p>
    </div>
  </div>
    
  </div>
  

</header>

<p>https://www.kaggle.com/code/kabure/extensive-eda-and-modeling-xgb-hyperopt</p>
<section id="tasks" class="level1">
<h1>1. Tasks</h1>
<p>This data analytics project revolves around enhancing fraud detection in online financial transactions, a critical business use case vital for both consumers and businesses. The significance lies in the escalating threat of fraudulent activities within e-commerce, leading to substantial financial losses for businesses and potential security risks for consumers.</p>
<p>Our primary focus is to leverage a comprehensive dataset sourced from Vesta Corporation, a leading payment service company, to develop and refine machine learning models aimed at accurately distinguishing between legitimate and fraudulent transactions.</p>
<p>The original evaluation metric for this Kaggle competition is ROC AUC; however, due to the imbalance data problem (shown in isFruad section), I think it’s better to use Precision-Recall Curve AUC as the evaluation metric. Let’s talk about why.</p>
<section id="roc-curve" class="level2">
<h2 class="anchored" data-anchor-id="roc-curve">ROC Curve</h2>

<table>
<tbody><tr>
<td>
<img src="image/roc_curve.png" width="300" height="300">
</td>
<td>
<img src="image/tpr_tnr.png" width="400" height="300">
</td>
</tr>

</tbody></table>
<p>ROC curve uses True Positive Rate (TPR) and True Negative Rate (TNR) as y-axis and x-axis.</p>
<p>TPR indicates the model’s ability to distinguish postive data; TNR indicates the model’s ability to distinguish negative data. Thus, ROC curve shows the overall ability to distinguish postive and negative classes.</p>
<p>However, in imbalance dataset with small amount of TP, TNR is not what we care about.</p>
</section>
<section id="precision-recall-curve" class="level2">
<h2 class="anchored" data-anchor-id="precision-recall-curve">Precision-Recall Curve</h2>

<table>
<tbody><tr>
<td>
<img src="image/precision_recall_curve.png" width="300" height="300">
</td>
<td>
<img src="image/precision_recall.png" width="500" height="300">
</td>
</tr>

</tbody></table>
<p>Precision-Recall curve uses Precision and Recall as y-axis and x-axis.</p>
<p>Recall indicates the model’s ability to distinguish postive data; Precision indicates how many of the predicted positive cases are actually positive. Thus, Precision-Recall curve shows the overall ability to find as many as positive cases and also with a precise prediction.</p>
<p>Given our imbalanced dataset with a small number of TP and considering the real-world scenario of monitoring fraudulent transactions, utilizing the Precision-Recall curve would be prudent as it specifically emphasizes TP.</p>
</section>
</section>
<section id="import-packages" class="level1">
<h1>2. Import Packages</h1>
<div class="cell" data-tags="[]" data-execution_count="71">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy <span class="im">import</span> stats</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> datetime</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="135">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for modeling</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LogisticRegression</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> precision_recall_curve, f1_score</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder, StandardScaler</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.compose <span class="im">import</span> ColumnTransformer</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.pipeline <span class="im">import</span> Pipeline</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="72">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ignore all warnings</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">"ignore"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="predefined-functions" class="level1">
<h1>3. Predefined Functions</h1>
<div class="cell" data-tags="[]" data-execution_count="73">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to reduce the DF size</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> reduce_mem_usage(df, verbose<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    numerics <span class="op">=</span> [<span class="st">'int16'</span>, <span class="st">'int32'</span>, <span class="st">'int64'</span>, <span class="st">'float16'</span>, <span class="st">'float32'</span>, <span class="st">'float64'</span>]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    start_mem <span class="op">=</span> df.memory_usage().<span class="bu">sum</span>() <span class="op">/</span> <span class="dv">1024</span><span class="op">**</span><span class="dv">2</span>    </span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> col <span class="kw">in</span> df.columns:</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        col_type <span class="op">=</span> df[col].dtypes</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> col_type <span class="kw">in</span> numerics:</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>            c_min <span class="op">=</span> df[col].<span class="bu">min</span>()</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>            c_max <span class="op">=</span> df[col].<span class="bu">max</span>()</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">str</span>(col_type)[:<span class="dv">3</span>] <span class="op">==</span> <span class="st">'int'</span>:</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> c_min <span class="op">&gt;</span> np.iinfo(np.int8).<span class="bu">min</span> <span class="kw">and</span> c_max <span class="op">&lt;</span> np.iinfo(np.int8).<span class="bu">max</span>:</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>                    df[col] <span class="op">=</span> df[col].astype(np.int8)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> c_min <span class="op">&gt;</span> np.iinfo(np.int16).<span class="bu">min</span> <span class="kw">and</span> c_max <span class="op">&lt;</span> np.iinfo(np.int16).<span class="bu">max</span>:</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                    df[col] <span class="op">=</span> df[col].astype(np.int16)</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> c_min <span class="op">&gt;</span> np.iinfo(np.int32).<span class="bu">min</span> <span class="kw">and</span> c_max <span class="op">&lt;</span> np.iinfo(np.int32).<span class="bu">max</span>:</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                    df[col] <span class="op">=</span> df[col].astype(np.int32)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> c_min <span class="op">&gt;</span> np.iinfo(np.int64).<span class="bu">min</span> <span class="kw">and</span> c_max <span class="op">&lt;</span> np.iinfo(np.int64).<span class="bu">max</span>:</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                    df[col] <span class="op">=</span> df[col].astype(np.int64)  </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> c_min <span class="op">&gt;</span> np.finfo(np.float16).<span class="bu">min</span> <span class="kw">and</span> c_max <span class="op">&lt;</span> np.finfo(np.float16).<span class="bu">max</span>:</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                    df[col] <span class="op">=</span> df[col].astype(np.float16)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                <span class="cf">elif</span> c_min <span class="op">&gt;</span> np.finfo(np.float32).<span class="bu">min</span> <span class="kw">and</span> c_max <span class="op">&lt;</span> np.finfo(np.float32).<span class="bu">max</span>:</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                    df[col] <span class="op">=</span> df[col].astype(np.float32)</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>                <span class="cf">else</span>:</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                    df[col] <span class="op">=</span> df[col].astype(np.float64)    </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    end_mem <span class="op">=</span> df.memory_usage().<span class="bu">sum</span>() <span class="op">/</span> <span class="dv">1024</span><span class="op">**</span><span class="dv">2</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> verbose: <span class="bu">print</span>(<span class="st">'Mem. usage decreased to </span><span class="sc">{:5.2f}</span><span class="st"> Mb (</span><span class="sc">{:.1f}% r</span><span class="st">eduction)'</span>.<span class="bu">format</span>(end_mem, <span class="dv">100</span> <span class="op">*</span> (start_mem <span class="op">-</span> end_mem) <span class="op">/</span> start_mem))</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co">#summary of the dataframe</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> resumetable(df, columns):</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Dataset Shape: </span><span class="sc">{</span>df<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    summary <span class="op">=</span> pd.DataFrame(df[columns].dtypes, columns<span class="op">=</span>[<span class="st">'dtypes'</span>])</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    summary <span class="op">=</span> summary.reset_index()</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    summary[<span class="st">'Name'</span>] <span class="op">=</span> summary[<span class="st">'index'</span>]</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    summary <span class="op">=</span> summary[[<span class="st">'Name'</span>, <span class="st">'dtypes'</span>]]</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>    summary[<span class="st">'Missing'</span>] <span class="op">=</span> df[columns].isnull().<span class="bu">sum</span>().values</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>    summary[<span class="st">'Uniques'</span>] <span class="op">=</span> df[columns].nunique().values</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    summary[<span class="st">'First Value'</span>] <span class="op">=</span> df[columns].iloc[<span class="dv">0</span>].values</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>    summary[<span class="st">'Second Value'</span>] <span class="op">=</span> df[columns].iloc[<span class="dv">1</span>].values</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>    summary[<span class="st">'Third Value'</span>] <span class="op">=</span> df[columns].iloc[<span class="dv">2</span>].values    </span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> summary</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co">#plot two charts to perform in-depth analysis on different categorical columns</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co">#The top section (subplot 1) presents a count plot, illustrating the frequency of occurrences for each category and the corresponding percentage of fraudulent transactions. The bottom section (subplot 2) offers a bar plot depicting the total transaction amounts across different categories, coupled with the percentage of fraudulent transaction amounts. </span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> ploting_cnt_amt(df, col, lim<span class="op">=</span><span class="dv">2000</span>):</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> pd.crosstab(df[col], df[<span class="st">'isFraud'</span>], normalize<span class="op">=</span><span class="st">'index'</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>    tmp <span class="op">=</span> tmp.reset_index()</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>    tmp.rename(columns<span class="op">=</span>{<span class="dv">0</span>:<span class="st">'NoFraud'</span>, <span class="dv">1</span>:<span class="st">'Fraud'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">14</span>))    </span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    plt.suptitle(<span class="ss">f'</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> Distributions '</span>, fontsize<span class="op">=</span><span class="dv">24</span>)</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">211</span>)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>    g <span class="op">=</span> sns.countplot( x<span class="op">=</span>col,  data<span class="op">=</span>df, order<span class="op">=</span><span class="bu">list</span>(tmp[col].values))</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>    gt <span class="op">=</span> g.twinx()</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>    gt <span class="op">=</span> sns.pointplot(x<span class="op">=</span>col, y<span class="op">=</span><span class="st">'Fraud'</span>, data<span class="op">=</span>tmp, order<span class="op">=</span><span class="bu">list</span>(tmp[col].values),</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>                       color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>    gt.set_ylim(<span class="dv">0</span>,tmp[<span class="st">'Fraud'</span>].<span class="bu">max</span>()<span class="op">*</span><span class="fl">1.1</span>)</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    gt.set_ylabel(<span class="st">"</span><span class="sc">% F</span><span class="st">raud Transactions"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>    g.set_title(<span class="ss">f"Count of </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> values and % Fraud Transactions"</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>    g.set_xlabel(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> Category Names"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>    g.set_ylabel(<span class="ss">f"Count of </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">17</span>)</span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>    g.set_xticklabels(g.get_xticklabels(),rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a>    sizes <span class="op">=</span> []</span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> g.patches:</span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>        height <span class="op">=</span> p.get_height()</span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>        sizes.append(height)</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>        g.text(p.get_x()<span class="op">+</span>p.get_width()<span class="op">/</span><span class="fl">2.</span>,</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>                height <span class="op">+</span> <span class="dv">3</span>,</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>                <span class="st">'</span><span class="sc">{:1.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(height<span class="op">/</span>total<span class="op">*</span><span class="dv">100</span>),</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">"center"</span>,fontsize<span class="op">=</span><span class="dv">12</span>) </span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>    g.set_ylim(<span class="dv">0</span>,<span class="bu">max</span>(sizes)<span class="op">*</span><span class="fl">1.15</span>)</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>    <span class="co">#########################################################################</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>    perc_amt <span class="op">=</span> (df.groupby([<span class="st">'isFraud'</span>,col])[<span class="st">'TransactionAmt'</span>].<span class="bu">sum</span>() <span class="op">\</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>                <span class="op">/</span> df.groupby([col])[<span class="st">'TransactionAmt'</span>].<span class="bu">sum</span>() <span class="op">*</span> <span class="dv">100</span>).unstack(<span class="st">'isFraud'</span>)</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>    perc_amt <span class="op">=</span> perc_amt.reset_index()</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>    perc_amt.rename(columns<span class="op">=</span>{<span class="dv">0</span>:<span class="st">'NoFraud'</span>, <span class="dv">1</span>:<span class="st">'Fraud'</span>}, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a>    amt <span class="op">=</span> df.groupby([col])[<span class="st">'TransactionAmt'</span>].<span class="bu">sum</span>().reset_index()</span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>    perc_amt <span class="op">=</span> perc_amt.fillna(<span class="dv">0</span>)</span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">212</span>)</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>    g1 <span class="op">=</span> sns.barplot(x<span class="op">=</span>col, y<span class="op">=</span><span class="st">'TransactionAmt'</span>, </span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>                       data<span class="op">=</span>amt, </span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>                       order<span class="op">=</span><span class="bu">list</span>(tmp[col].values))</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>    g1t <span class="op">=</span> g1.twinx()</span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>    g1t <span class="op">=</span> sns.pointplot(x<span class="op">=</span>col, y<span class="op">=</span><span class="st">'Fraud'</span>, data<span class="op">=</span>perc_amt, </span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>                        order<span class="op">=</span><span class="bu">list</span>(tmp[col].values),</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>                       color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>    g1t.set_ylim(<span class="dv">0</span>,perc_amt[<span class="st">'Fraud'</span>].<span class="bu">max</span>()<span class="op">*</span><span class="fl">1.1</span>)</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>    g1t.set_ylabel(<span class="st">"</span><span class="sc">% F</span><span class="st">raud Total Amount"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>    g.set_xticklabels(g.get_xticklabels(),rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>    g1.set_title(<span class="ss">f"Transaction Amount by </span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> + % Fraud Transactions Amount"</span>, fontsize<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>    g1.set_xlabel(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss"> Category Names"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>    g1.set_ylabel(<span class="st">"Transaction Amount (US$)"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>    g1.set_xticklabels(g.get_xticklabels(),rotation<span class="op">=</span><span class="dv">45</span>)    </span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> p <span class="kw">in</span> g1.patches:</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>        height <span class="op">=</span> p.get_height()</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>        g1.text(p.get_x()<span class="op">+</span>p.get_width()<span class="op">/</span><span class="fl">2.</span>,</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>                height <span class="op">+</span> <span class="dv">3</span>,</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>                <span class="st">'</span><span class="sc">{:1.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(height<span class="op">/</span>total_amt<span class="op">*</span><span class="dv">100</span>),</span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>                ha<span class="op">=</span><span class="st">"center"</span>,fontsize<span class="op">=</span><span class="dv">12</span>) </span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>    plt.subplots_adjust(hspace<span class="op">=</span><span class="fl">.4</span>, top <span class="op">=</span> <span class="fl">0.9</span>)</span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate missing value percentage for a column</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_missing_percentage(df, column_name):</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>    missing_values <span class="op">=</span> df[column_name].isnull().<span class="bu">sum</span>()</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>    total_rows <span class="op">=</span> df.shape[<span class="dv">0</span>]</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>    missing_pct <span class="op">=</span> <span class="bu">round</span>(missing_values <span class="op">/</span> total_rows <span class="op">*</span> <span class="dv">100</span>, <span class="dv">2</span>)</span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Missing value percentage for </span><span class="sc">{</span>column_name<span class="sc">}</span><span class="ss">: </span><span class="sc">{</span>missing_pct<span class="sc">}</span><span class="ss">%"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="read-data" class="level1">
<h1>4. Read Data</h1>
<div class="cell" data-tags="[]" data-execution_count="74">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>transaction <span class="op">=</span> pd.read_csv(<span class="st">'data/train_transaction.csv'</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>identity <span class="op">=</span> pd.read_csv(<span class="st">'data/train_identity.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="columns-descriptions" class="level1">
<h1>5. Columns Descriptions</h1>
<div class="cell" data-tags="[]" data-execution_count="75">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>transaction_cols <span class="op">=</span> <span class="bu">list</span>(transaction.columns)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(transaction_cols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['TransactionID', 'isFraud', 'TransactionDT', 'TransactionAmt', 'ProductCD', 'card1', 'card2', 'card3', 'card4', 'card5', 'card6', 'addr1', 'addr2', 'dist1', 'dist2', 'P_emaildomain', 'R_emaildomain', 'C1', 'C2', 'C3', 'C4', 'C5', 'C6', 'C7', 'C8', 'C9', 'C10', 'C11', 'C12', 'C13', 'C14', 'D1', 'D2', 'D3', 'D4', 'D5', 'D6', 'D7', 'D8', 'D9', 'D10', 'D11', 'D12', 'D13', 'D14', 'D15', 'M1', 'M2', 'M3', 'M4', 'M5', 'M6', 'M7', 'M8', 'M9', 'V1', 'V2', 'V3', 'V4', 'V5', 'V6', 'V7', 'V8', 'V9', 'V10', 'V11', 'V12', 'V13', 'V14', 'V15', 'V16', 'V17', 'V18', 'V19', 'V20', 'V21', 'V22', 'V23', 'V24', 'V25', 'V26', 'V27', 'V28', 'V29', 'V30', 'V31', 'V32', 'V33', 'V34', 'V35', 'V36', 'V37', 'V38', 'V39', 'V40', 'V41', 'V42', 'V43', 'V44', 'V45', 'V46', 'V47', 'V48', 'V49', 'V50', 'V51', 'V52', 'V53', 'V54', 'V55', 'V56', 'V57', 'V58', 'V59', 'V60', 'V61', 'V62', 'V63', 'V64', 'V65', 'V66', 'V67', 'V68', 'V69', 'V70', 'V71', 'V72', 'V73', 'V74', 'V75', 'V76', 'V77', 'V78', 'V79', 'V80', 'V81', 'V82', 'V83', 'V84', 'V85', 'V86', 'V87', 'V88', 'V89', 'V90', 'V91', 'V92', 'V93', 'V94', 'V95', 'V96', 'V97', 'V98', 'V99', 'V100', 'V101', 'V102', 'V103', 'V104', 'V105', 'V106', 'V107', 'V108', 'V109', 'V110', 'V111', 'V112', 'V113', 'V114', 'V115', 'V116', 'V117', 'V118', 'V119', 'V120', 'V121', 'V122', 'V123', 'V124', 'V125', 'V126', 'V127', 'V128', 'V129', 'V130', 'V131', 'V132', 'V133', 'V134', 'V135', 'V136', 'V137', 'V138', 'V139', 'V140', 'V141', 'V142', 'V143', 'V144', 'V145', 'V146', 'V147', 'V148', 'V149', 'V150', 'V151', 'V152', 'V153', 'V154', 'V155', 'V156', 'V157', 'V158', 'V159', 'V160', 'V161', 'V162', 'V163', 'V164', 'V165', 'V166', 'V167', 'V168', 'V169', 'V170', 'V171', 'V172', 'V173', 'V174', 'V175', 'V176', 'V177', 'V178', 'V179', 'V180', 'V181', 'V182', 'V183', 'V184', 'V185', 'V186', 'V187', 'V188', 'V189', 'V190', 'V191', 'V192', 'V193', 'V194', 'V195', 'V196', 'V197', 'V198', 'V199', 'V200', 'V201', 'V202', 'V203', 'V204', 'V205', 'V206', 'V207', 'V208', 'V209', 'V210', 'V211', 'V212', 'V213', 'V214', 'V215', 'V216', 'V217', 'V218', 'V219', 'V220', 'V221', 'V222', 'V223', 'V224', 'V225', 'V226', 'V227', 'V228', 'V229', 'V230', 'V231', 'V232', 'V233', 'V234', 'V235', 'V236', 'V237', 'V238', 'V239', 'V240', 'V241', 'V242', 'V243', 'V244', 'V245', 'V246', 'V247', 'V248', 'V249', 'V250', 'V251', 'V252', 'V253', 'V254', 'V255', 'V256', 'V257', 'V258', 'V259', 'V260', 'V261', 'V262', 'V263', 'V264', 'V265', 'V266', 'V267', 'V268', 'V269', 'V270', 'V271', 'V272', 'V273', 'V274', 'V275', 'V276', 'V277', 'V278', 'V279', 'V280', 'V281', 'V282', 'V283', 'V284', 'V285', 'V286', 'V287', 'V288', 'V289', 'V290', 'V291', 'V292', 'V293', 'V294', 'V295', 'V296', 'V297', 'V298', 'V299', 'V300', 'V301', 'V302', 'V303', 'V304', 'V305', 'V306', 'V307', 'V308', 'V309', 'V310', 'V311', 'V312', 'V313', 'V314', 'V315', 'V316', 'V317', 'V318', 'V319', 'V320', 'V321', 'V322', 'V323', 'V324', 'V325', 'V326', 'V327', 'V328', 'V329', 'V330', 'V331', 'V332', 'V333', 'V334', 'V335', 'V336', 'V337', 'V338', 'V339']</code></pre>
</div>
</div>
<p><strong>Transaction columns description</strong>:</p>
<ul>
<li>TransactionDT: timedelta from a given reference datetime (not an actual timestamp), start date = ‘2017-12-01’</li>
<li>TransactionAMT: transaction payment amount in USD</li>
<li>ProductCD: product code, the product for each transaction</li>
<li>card1 - card6: payment card information, such as card type, card category, issue bank, country, etc.</li>
<li>addr: address, both addr is for purchaser, addr1 is billing region and addr2 is billing country</li>
<li>dist: distance, distances between (not limited) billing address, mailing address, zip code, IP address, phone area, etc.</li>
<li>P_ and (R__) emaildomain: purchaser and recipient email domain</li>
<li>C1-C14: counting, such as how many addresses are found to be associated with the payment card, etc. The actual meaning is masked.</li>
<li>D1-D15: timedelta, such as days between previous transaction, etc.</li>
<li>M1-M9: match, such as names on card and address, etc.</li>
<li>Vxxx: Vesta engineered rich features, including ranking, counting, and other entity relations.</li>
</ul>
<div class="cell" data-tags="[]" data-execution_count="76">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>identity_cols <span class="op">=</span> <span class="bu">list</span>(identity.columns)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(identity_cols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['TransactionID', 'id_01', 'id_02', 'id_03', 'id_04', 'id_05', 'id_06', 'id_07', 'id_08', 'id_09', 'id_10', 'id_11', 'id_12', 'id_13', 'id_14', 'id_15', 'id_16', 'id_17', 'id_18', 'id_19', 'id_20', 'id_21', 'id_22', 'id_23', 'id_24', 'id_25', 'id_26', 'id_27', 'id_28', 'id_29', 'id_30', 'id_31', 'id_32', 'id_33', 'id_34', 'id_35', 'id_36', 'id_37', 'id_38', 'DeviceType', 'DeviceInfo']</code></pre>
</div>
</div>
<p><strong>Identity columns description</strong>:</p>
<ul>
<li>id: network connection information (IP, ISP, Proxy, etc) and digital signature (UA/browser/os/version, etc) associated with transactions.</li>
</ul>
<p><strong>Numerous columns, including C1-C14, D1-D15, M1-M9, Vxxx, and id, obscure their true meanings. To derive meaningful business conclusions and recommendations, my focus will be on those explainable columns.</strong></p>
</section>
<section id="eda" class="level1">
<h1>6. EDA</h1>
<div class="cell" data-tags="[]" data-execution_count="77">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">## REducing memory</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df_trans <span class="op">=</span> reduce_mem_usage(transaction)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>df_id <span class="op">=</span> reduce_mem_usage(identity)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Mem. usage decreased to 542.35 Mb (69.4% reduction)
Mem. usage decreased to 25.86 Mb (42.7% reduction)</code></pre>
</div>
</div>
<section id="eda-transaction" class="level2">
<h2 class="anchored" data-anchor-id="eda-transaction">6-1. EDA-Transaction</h2>
<div class="cell" data-tags="[]" data-execution_count="78">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, df_trans.columns.tolist())[:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 394)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="78">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>TransactionID</td>
      <td>int32</td>
      <td>0</td>
      <td>590540</td>
      <td>2987000</td>
      <td>2987001</td>
      <td>2987002</td>
    </tr>
    <tr>
      <th>1</th>
      <td>isFraud</td>
      <td>int8</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>TransactionDT</td>
      <td>int32</td>
      <td>0</td>
      <td>573349</td>
      <td>86400</td>
      <td>86401</td>
      <td>86469</td>
    </tr>
    <tr>
      <th>3</th>
      <td>TransactionAmt</td>
      <td>float16</td>
      <td>0</td>
      <td>8195</td>
      <td>68.5</td>
      <td>29.0</td>
      <td>59.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ProductCD</td>
      <td>object</td>
      <td>0</td>
      <td>5</td>
      <td>W</td>
      <td>W</td>
      <td>W</td>
    </tr>
    <tr>
      <th>5</th>
      <td>card1</td>
      <td>int16</td>
      <td>0</td>
      <td>13553</td>
      <td>13926</td>
      <td>2755</td>
      <td>4663</td>
    </tr>
    <tr>
      <th>6</th>
      <td>card2</td>
      <td>float16</td>
      <td>8933</td>
      <td>500</td>
      <td>NaN</td>
      <td>404.0</td>
      <td>490.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>card3</td>
      <td>float16</td>
      <td>1565</td>
      <td>114</td>
      <td>150.0</td>
      <td>150.0</td>
      <td>150.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>card4</td>
      <td>object</td>
      <td>1577</td>
      <td>4</td>
      <td>discover</td>
      <td>mastercard</td>
      <td>visa</td>
    </tr>
    <tr>
      <th>9</th>
      <td>card5</td>
      <td>float16</td>
      <td>4259</td>
      <td>119</td>
      <td>142.0</td>
      <td>102.0</td>
      <td>166.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<section id="transactionid" class="level3">
<h3 class="anchored" data-anchor-id="transactionid">TransactionID</h3>
<p>TransactionID has 590540 unique values, which is the same as df_trans’s rows, so that we can confirm TransactionID is a valid primary key.</p>
</section>
<section id="isfraud" class="level3">
<h3 class="anchored" data-anchor-id="isfraud">isFraud</h3>
<p>The fraudulent transactions, both in count and total amount, represent only a small portion of the overall transactions. This suggests an imbalance in the data, which is an issue we should consider when building models.</p>
<div class="cell" data-execution_count="79">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'TransactionAmt'</span>] <span class="op">=</span> df_trans[<span class="st">'TransactionAmt'</span>].astype(<span class="bu">float</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>total <span class="op">=</span> <span class="bu">len</span>(df_trans)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>total_amt <span class="op">=</span> df_trans.groupby([<span class="st">'isFraud'</span>])[<span class="st">'TransactionAmt'</span>].<span class="bu">sum</span>().<span class="bu">sum</span>()</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>,<span class="dv">6</span>))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">121</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.countplot(x<span class="op">=</span><span class="st">'isFraud'</span>, data<span class="op">=</span>df_trans, )</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>g.set_title(<span class="st">"Count of Transaction"</span>, fontsize<span class="op">=</span><span class="dv">22</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>g.set_xlabel(<span class="st">"Is fraud?"</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>g.set_ylabel(<span class="st">'Count'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> g.patches:</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> p.get_height()</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    g.text(p.get_x()<span class="op">+</span>p.get_width()<span class="op">/</span><span class="fl">2.</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>            height,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'</span><span class="sc">{:1.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(height<span class="op">/</span>total<span class="op">*</span><span class="dv">100</span>),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>            ha<span class="op">=</span><span class="st">"center"</span>, fontsize<span class="op">=</span><span class="dv">15</span>) </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>perc_amt <span class="op">=</span> (df_trans.groupby([<span class="st">'isFraud'</span>])[<span class="st">'TransactionAmt'</span>].<span class="bu">sum</span>())</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>perc_amt <span class="op">=</span> perc_amt.reset_index()</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">122</span>)</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>g1 <span class="op">=</span> sns.barplot(x<span class="op">=</span><span class="st">'isFraud'</span>, y<span class="op">=</span><span class="st">'TransactionAmt'</span>,  dodge<span class="op">=</span><span class="va">True</span>, data<span class="op">=</span>perc_amt)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>g1.set_title(<span class="st">"Transaction Amount"</span>, fontsize<span class="op">=</span><span class="dv">22</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>g1.set_xlabel(<span class="st">"Is fraud?"</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a>g1.set_ylabel(<span class="st">'Total Transaction Amount Scalar'</span>, fontsize<span class="op">=</span><span class="dv">18</span>)</span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> p <span class="kw">in</span> g1.patches:</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    height <span class="op">=</span> p.get_height()</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    g1.text(p.get_x()<span class="op">+</span>p.get_width()<span class="op">/</span><span class="fl">2.</span>,</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>            height <span class="op">+</span> <span class="dv">3</span>,</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">'</span><span class="sc">{:1.2f}</span><span class="st">%'</span>.<span class="bu">format</span>(height<span class="op">/</span>total_amt <span class="op">*</span> <span class="dv">100</span>),</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>            ha<span class="op">=</span><span class="st">"center"</span>, fontsize<span class="op">=</span><span class="dv">15</span>) </span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection2_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="transactiondt" class="level3">
<h3 class="anchored" data-anchor-id="transactiondt">TransactionDT</h3>
<ol type="1">
<li>Min Date: 2017-12-02 00:00:00, Max Date: 2018-06-01 23:58:51</li>
<li>The range of TransactionDT is about half a year</li>
<li>Fraudulent transactions are likely associated with Hours</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="80">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, [<span class="st">"TransactionDT"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 394)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="80">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>TransactionDT</td>
      <td>int32</td>
      <td>0</td>
      <td>573349</td>
      <td>86400</td>
      <td>86401</td>
      <td>86469</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Looking at the first, second and third value, it appears that the <code>TransactionDT</code> is structured in a format resembling a time delta measured in seconds. Let’s delve deeper into this for further exploration.</p>
<div class="cell" data-tags="[]" data-execution_count="81">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>TransactionDT_min <span class="op">=</span> df_trans[<span class="st">'TransactionDT'</span>].<span class="bu">min</span>()</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>TransactionDT_max <span class="op">=</span> df_trans[<span class="st">'TransactionDT'</span>].<span class="bu">max</span>()</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>convert_to_days <span class="op">=</span> <span class="dv">24</span><span class="op">*</span><span class="dv">60</span><span class="op">*</span><span class="dv">60</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>TransactionDT_range <span class="op">=</span> (TransactionDT_max<span class="op">-</span>TransactionDT_min)<span class="op">/</span>convert_to_days</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min TransactionDT:</span><span class="sc">{</span>TransactionDT_min<span class="sc">}</span><span class="ss">; Max TransactionDT:</span><span class="sc">{</span>TransactionDT_max<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"TransactionDT Range (days):</span><span class="sc">{</span>TransactionDT_range<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"The range of TransactionDT is about half a year."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Min TransactionDT:86400; Max TransactionDT:15811131
TransactionDT Range (days):181.99920138888888
The range of TransactionDT is about half a year.</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="82">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>START_DATE <span class="op">=</span> <span class="st">'2017-12-01'</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>startdate <span class="op">=</span> datetime.datetime.strptime(START_DATE, <span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">"</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">"Date"</span>] <span class="op">=</span> df_trans[<span class="st">'TransactionDT'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: (startdate <span class="op">+</span> datetime.timedelta(seconds<span class="op">=</span>x)))</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'_Weekdays'</span>] <span class="op">=</span> df_trans[<span class="st">'Date'</span>].dt.dayofweek</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'_Hours'</span>] <span class="op">=</span> df_trans[<span class="st">'Date'</span>].dt.hour</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'_Days'</span>] <span class="op">=</span> df_trans[<span class="st">'Date'</span>].dt.day</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>min_date, max_date <span class="op">=</span> df_trans[<span class="st">"Date"</span>].<span class="bu">min</span>(), df_trans[<span class="st">"Date"</span>].<span class="bu">max</span>()</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min Date: </span><span class="sc">{</span>min_date<span class="sc">}</span><span class="ss">, Max Date: </span><span class="sc">{</span>max_date<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Min Date: 2017-12-02 00:00:00, Max Date: 2018-06-01 23:58:51</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="83">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create subplots with shared y-axis</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>ax1 <span class="op">=</span> plt.subplot(<span class="dv">131</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>ax1.plot(df_trans.groupby(<span class="st">'_Days'</span>).mean()[<span class="st">'isFraud'</span>])</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>ax1.set_xlabel(<span class="st">'Day of Month'</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>ax1.set_ylabel(<span class="st">'Fraction of fraudulent transactions'</span>)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.subplot(<span class="dv">132</span>, sharey<span class="op">=</span>ax1)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>ax2.plot(df_trans.groupby(<span class="st">'_Weekdays'</span>).mean()[<span class="st">'isFraud'</span>])</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Day of week'</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Fraction of fraudulent transactions'</span>)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>ax2 <span class="op">=</span> plt.subplot(<span class="dv">133</span>, sharey<span class="op">=</span>ax1)  <span class="co"># Share y-axis with ax1</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>ax2.plot(df_trans.groupby(<span class="st">'_Hours'</span>).mean()[<span class="st">'isFraud'</span>])</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>ax2.set_xlabel(<span class="st">'Hour'</span>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>ax2.set_ylabel(<span class="st">'Fraction of fraudulent transactions'</span>)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Fraudulent Transactions Distribution by Day of Month/ Day of week/ Hour"</span>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection2_files/figure-html/cell-15-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>It appears that fraudulent transactions are more closely associated with the hour of the day rather than the day of the week. We can consider this as one of the feature for our model.</p>
</section>
<section id="transactionamt" class="level3">
<h3 class="anchored" data-anchor-id="transactionamt">TransactionAmt</h3>
<ol type="1">
<li>The distribution of TransactionAmt is quite skewed.</li>
<li>After log transfomration, fraud’s TransactionAmt is more spread out between Q1 and Q3.</li>
<li>After log transformation, Not Fruad has more outliers.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="84">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'TransactionAmt'</span>].plot(kind<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>          bins<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>          figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'Distribution of Transaction Amt'</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection2_files/figure-html/cell-16-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>The distribution of TransactionAmt is quite skewwed, so let’s convert it with log transformation</p>
<div class="cell" data-tags="[]" data-execution_count="85">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'TransactionAmt'</span>] <span class="op">\</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    .<span class="bu">apply</span>(np.log) <span class="op">\</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    .plot(kind<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>          bins<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>          figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">5</span>),</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'Distribution of Log Transaction Amt'</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection2_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="86">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>color_pal <span class="op">=</span> [x[<span class="st">'color'</span>] <span class="cf">for</span> x <span class="kw">in</span> plt.rcParams[<span class="st">'axes.prop_cycle'</span>]]</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>fig, ((ax1, ax2), (ax3, ax4)) <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">6</span>))</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>df_trans.loc[df_trans[<span class="st">'isFraud'</span>] <span class="op">==</span> <span class="dv">1</span>] <span class="op">\</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'TransactionAmt'</span>].<span class="bu">apply</span>(np.log) <span class="op">\</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    .plot(kind<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>          bins<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'Log Transaction Amt - Fraud'</span>,</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>          color<span class="op">=</span>color_pal[<span class="dv">1</span>],</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>          xlim<span class="op">=</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">10</span>),</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>         ax<span class="op">=</span> ax1)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>df_trans.loc[df_trans[<span class="st">'isFraud'</span>] <span class="op">==</span> <span class="dv">0</span>] <span class="op">\</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'TransactionAmt'</span>].<span class="bu">apply</span>(np.log) <span class="op">\</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    .plot(kind<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>          bins<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'Log Transaction Amt - Not Fraud'</span>,</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>          color<span class="op">=</span>color_pal[<span class="dv">2</span>],</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>          xlim<span class="op">=</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">10</span>),</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>         ax<span class="op">=</span>ax2)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>df_trans.loc[df_trans[<span class="st">'isFraud'</span>] <span class="op">==</span> <span class="dv">1</span>] <span class="op">\</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'TransactionAmt'</span>] <span class="op">\</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    .plot(kind<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>          bins<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'Transaction Amt - Fraud'</span>,</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>          color<span class="op">=</span>color_pal[<span class="dv">1</span>],</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>         ax<span class="op">=</span> ax3)</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>df_trans.loc[df_trans[<span class="st">'isFraud'</span>] <span class="op">==</span> <span class="dv">0</span>] <span class="op">\</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    [<span class="st">'TransactionAmt'</span>] <span class="op">\</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    .plot(kind<span class="op">=</span><span class="st">'hist'</span>,</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>          bins<span class="op">=</span><span class="dv">100</span>,</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>          title<span class="op">=</span><span class="st">'Transaction Amt - Not Fraud'</span>,</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>          color<span class="op">=</span>color_pal[<span class="dv">2</span>],</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>         ax<span class="op">=</span>ax4)</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection2_files/figure-html/cell-18-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="87">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply log transformation to transaction amounts</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'Log_TransactionAmt'</span>] <span class="op">=</span> np.log(df_trans[<span class="st">'TransactionAmt'</span>] <span class="op">+</span> <span class="dv">1</span>)  <span class="co"># Adding 1 to avoid log(0)</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>sns.boxplot(x<span class="op">=</span><span class="st">'isFraud'</span>, y<span class="op">=</span><span class="st">'Log_TransactionAmt'</span>, data<span class="op">=</span>df_trans)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Log Transaction Amount Distribution - Not Fraud vs Fraud'</span>)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Fraud Status'</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Log Transaction Amount'</span>)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection2_files/figure-html/cell-19-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="isfraud-transactiondt-transactionamt" class="level3">
<h3 class="anchored" data-anchor-id="isfraud-transactiondt-transactionamt">isFraud &amp; TransactionDT &amp; TransactionAmt</h3>
<ol type="1">
<li>fraud rate occurs between 4 am to 11 am, characterized by fewer transactions and lower transaction amounts.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="88">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>ploting_cnt_amt(df_trans, <span class="st">'_Hours'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection2_files/figure-html/cell-20-output-1.png" class="img-fluid"></p>
</div>
</div>
<p>When initially analyzing TransactionDT in the previous section, we observed variations in the fraud rate across different hours. Subsequently, examining the two charts above, we identify that the fraud rate occurs between 4 am to 11 am, characterized by fewer transactions and lower transaction amounts. A plausible business hypothesis could suggest that these types of fraud might originate overseas, potentially in different time zones from the local time.</p>
</section>
<section id="isfraud-transactiondt-productcd" class="level3">
<h3 class="anchored" data-anchor-id="isfraud-transactiondt-productcd">isFraud &amp; TransactionDT &amp; ProductCD</h3>
<ol type="1">
<li>Product C has the highest fraud rate, which is 6 times than Product W.</li>
<li>The main product W has the lowest fraud rate.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="89">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, [<span class="st">'ProductCD'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 399)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="89">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ProductCD</td>
      <td>object</td>
      <td>0</td>
      <td>5</td>
      <td>W</td>
      <td>W</td>
      <td>W</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="90">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>ploting_cnt_amt(df_trans, <span class="st">'ProductCD'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection2_files/figure-html/cell-22-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="card1-6" class="level3">
<h3 class="anchored" data-anchor-id="card1-6">Card1-6</h3>
<ul>
<li>card4 (issuer company):
<ol type="1">
<li>Visa and Mastercard are the two main issuer companies and these two companies have similar fraudd rate.</li>
<li>Discover has the highest fraud rate.</li>
</ol></li>
<li>card6 (card type):
<ol type="1">
<li>debit and credit card are the two main types.</li>
<li>credit card is less common but with higher fraud rate.</li>
</ol></li>
</ul>
<div class="cell" data-tags="[]" data-execution_count="91">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, [<span class="st">'card1'</span>, <span class="st">'card2'</span>, <span class="st">'card3'</span>,<span class="st">'card4'</span>, <span class="st">'card5'</span>, <span class="st">'card6'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 399)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="91">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>card1</td>
      <td>int16</td>
      <td>0</td>
      <td>13553</td>
      <td>13926</td>
      <td>2755</td>
      <td>4663</td>
    </tr>
    <tr>
      <th>1</th>
      <td>card2</td>
      <td>float16</td>
      <td>8933</td>
      <td>500</td>
      <td>NaN</td>
      <td>404.0</td>
      <td>490.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>card3</td>
      <td>float16</td>
      <td>1565</td>
      <td>114</td>
      <td>150.0</td>
      <td>150.0</td>
      <td>150.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>card4</td>
      <td>object</td>
      <td>1577</td>
      <td>4</td>
      <td>discover</td>
      <td>mastercard</td>
      <td>visa</td>
    </tr>
    <tr>
      <th>4</th>
      <td>card5</td>
      <td>float16</td>
      <td>4259</td>
      <td>119</td>
      <td>142.0</td>
      <td>102.0</td>
      <td>166.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>card6</td>
      <td>object</td>
      <td>1571</td>
      <td>4</td>
      <td>credit</td>
      <td>credit</td>
      <td>debit</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Out of the provided variables, four are numeric, and two are categorical. As the dataset lacks explicit definitions for the numeric variables, let’s concentrate on the categorical ones, which we can infer likely represent the card issuer company and card type.</p>
<div class="cell" data-tags="[]" data-execution_count="92">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_trans, <span class="st">'card4'</span>)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>df_trans.card4 <span class="op">=</span> df_trans.card4.fillna(<span class="st">'NAN'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for card4: 0.27%</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="93">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ploting_cnt_amt(df_trans, <span class="st">'card4'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection2_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="94">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_trans, <span class="st">'card6'</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>df_trans.card6 <span class="op">=</span> df_trans.card6.fillna(<span class="st">'NAN'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for card6: 0.27%</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="95">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>ploting_cnt_amt(df_trans, <span class="st">'card6'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection2_files/figure-html/cell-27-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="address" class="level3">
<h3 class="anchored" data-anchor-id="address">address</h3>
<ul>
<li>addr1:
<ol type="1">
<li>Some addr1 have lower transaction and transaction amount but with higher fraud rate, which may imply addr1 is a factor of fraud rate.</li>
<li>Missing values of addr1 have much higher fraud rate, which may be a good indicator for fraud.</li>
</ol></li>
<li>addr2:
<ol type="1">
<li>99% is the same value, which indicates that it may not be a meaningful variable to predict fraud.</li>
</ol></li>
</ul>
<div class="cell" data-tags="[]" data-execution_count="96">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, [<span class="st">'addr1'</span>, <span class="st">'addr2'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 399)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="96">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>addr1</td>
      <td>float16</td>
      <td>65706</td>
      <td>332</td>
      <td>315.0</td>
      <td>325.0</td>
      <td>330.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>addr2</td>
      <td>float16</td>
      <td>65706</td>
      <td>74</td>
      <td>87.0</td>
      <td>87.0</td>
      <td>87.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>addr1 and addr2 should be categorical, so let’s transform them first.</p>
<div class="cell" data-tags="[]" data-execution_count="97">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'addr1'</span>] <span class="op">=</span> df_trans[<span class="st">'addr1'</span>].astype(<span class="st">'object'</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>df_trans[<span class="st">'addr2'</span>] <span class="op">=</span> df_trans[<span class="st">'addr2'</span>].astype(<span class="st">'object'</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, [<span class="st">'addr1'</span>, <span class="st">'addr2'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 399)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="97">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>addr1</td>
      <td>object</td>
      <td>65706</td>
      <td>332</td>
      <td>315.0</td>
      <td>325.0</td>
      <td>330.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>addr2</td>
      <td>object</td>
      <td>65706</td>
      <td>74</td>
      <td>87.0</td>
      <td>87.0</td>
      <td>87.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="98">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_trans, <span class="st">'addr1'</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_trans, <span class="st">'addr2'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for addr1: 11.13%
Missing value percentage for addr2: 11.13%</code></pre>
</div>
</div>
<p>Let’s fill missing values with “NAN”</p>
<div class="cell" data-tags="[]" data-execution_count="99">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df_trans.addr1 <span class="op">=</span> df_trans.addr1.fillna(<span class="st">'NAN'</span>)</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>df_trans.addr2 <span class="op">=</span> df_trans.addr2.fillna(<span class="st">'NAN'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="100">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> df_trans.groupby([<span class="st">'addr1'</span>])[<span class="st">'addr1'</span>].count().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>total_count <span class="op">=</span> result.<span class="bu">sum</span>()</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>result_percentage <span class="op">=</span> (result <span class="op">/</span> total_count) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>result_percentage</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="100">
<pre><code>addr1
NAN      11.126427
299.0     7.846209
325.0     7.239306
204.0     7.115521
264.0     6.751448
           ...    
425.0     0.000169
227.0     0.000169
232.0     0.000169
417.0     0.000169
427.0     0.000169
Name: addr1, Length: 333, dtype: float64</code></pre>
</div>
</div>
<p>There are 332 unique values, let’s focus on addr1 that appears more than 1%</p>
<div class="cell" data-tags="[]" data-execution_count="101">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> result_percentage[result_percentage <span class="op">&gt;</span> <span class="dv">1</span>].index</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>selected_rows <span class="op">=</span> df_trans.loc[df_trans.addr1.isin(indices)]</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>ploting_cnt_amt(selected_rows, <span class="st">'addr1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection2_files/figure-html/cell-33-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="102">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> df_trans.groupby([<span class="st">'addr2'</span>])[<span class="st">'addr2'</span>].count().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>total_count <span class="op">=</span> result.<span class="bu">sum</span>()</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>result_percentage <span class="op">=</span> (result <span class="op">/</span> total_count) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>result_percentage</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="102">
<pre><code>addr2
87.0    88.136451
NAN     11.126427
60.0     0.522234
96.0     0.108037
32.0     0.015410
          ...    
22.0     0.000169
25.0     0.000169
50.0     0.000169
49.0     0.000169
55.0     0.000169
Name: addr2, Length: 75, dtype: float64</code></pre>
</div>
</div>
<p>Almost all addr2 is 87, which indicates that this may not be a meaningful variable.</p>
</section>
<section id="p_email-domain" class="level3">
<h3 class="anchored" data-anchor-id="p_email-domain">P_Email domain</h3>
<ol type="1">
<li>Most transactions come from Google, Yahoo and missing value.</li>
<li>While Microsoft has the 4th highest transaction, it has the 1st fraud rate.</li>
<li>While spectrum has relatively low fraud rate, it has the 1st percentage of fraud amount.</li>
<li>es has higher fraud rate and amount.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="103">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, [<span class="st">'P_emaildomain'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 399)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="103">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>P_emaildomain</td>
      <td>object</td>
      <td>94456</td>
      <td>59</td>
      <td>NaN</td>
      <td>gmail.com</td>
      <td>outlook.com</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="104">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_trans, <span class="st">'P_emaildomain'</span>)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>df_trans.P_emaildomain <span class="op">=</span> df_trans.P_emaildomain.fillna(<span class="st">'NAN'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for P_emaildomain: 15.99%</code></pre>
</div>
</div>
<p>Let’s first rename similar domains to a same group of domain.</p>
<div class="cell" data-tags="[]" data-execution_count="105">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>emails <span class="op">=</span> {<span class="st">'gmail'</span>: <span class="st">'google'</span>, <span class="st">'att.net'</span>: <span class="st">'att'</span>, <span class="st">'twc.com'</span>: <span class="st">'spectrum'</span>, </span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">'scranton.edu'</span>: <span class="st">'other'</span>, <span class="st">'optonline.net'</span>: <span class="st">'other'</span>, <span class="st">'hotmail.co.uk'</span>: <span class="st">'microsoft'</span>,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">'comcast.net'</span>: <span class="st">'other'</span>, <span class="st">'yahoo.com.mx'</span>: <span class="st">'yahoo'</span>, <span class="st">'yahoo.fr'</span>: <span class="st">'yahoo'</span>,</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">'yahoo.es'</span>: <span class="st">'yahoo'</span>, <span class="st">'charter.net'</span>: <span class="st">'spectrum'</span>, <span class="st">'live.com'</span>: <span class="st">'microsoft'</span>, </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>          <span class="st">'aim.com'</span>: <span class="st">'aol'</span>, <span class="st">'hotmail.de'</span>: <span class="st">'microsoft'</span>, <span class="st">'centurylink.net'</span>: <span class="st">'centurylink'</span>,</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>          <span class="st">'gmail.com'</span>: <span class="st">'google'</span>, <span class="st">'me.com'</span>: <span class="st">'apple'</span>, <span class="st">'earthlink.net'</span>: <span class="st">'other'</span>, <span class="st">'gmx.de'</span>: <span class="st">'other'</span>,</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>          <span class="st">'web.de'</span>: <span class="st">'other'</span>, <span class="st">'cfl.rr.com'</span>: <span class="st">'other'</span>, <span class="st">'hotmail.com'</span>: <span class="st">'microsoft'</span>, </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>          <span class="st">'protonmail.com'</span>: <span class="st">'other'</span>, <span class="st">'hotmail.fr'</span>: <span class="st">'microsoft'</span>, <span class="st">'windstream.net'</span>: <span class="st">'other'</span>, </span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>          <span class="st">'outlook.es'</span>: <span class="st">'microsoft'</span>, <span class="st">'yahoo.co.jp'</span>: <span class="st">'yahoo'</span>, <span class="st">'yahoo.de'</span>: <span class="st">'yahoo'</span>,</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>          <span class="st">'servicios-ta.com'</span>: <span class="st">'other'</span>, <span class="st">'netzero.net'</span>: <span class="st">'other'</span>, <span class="st">'suddenlink.net'</span>: <span class="st">'other'</span>,</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>          <span class="st">'roadrunner.com'</span>: <span class="st">'other'</span>, <span class="st">'sc.rr.com'</span>: <span class="st">'other'</span>, <span class="st">'live.fr'</span>: <span class="st">'microsoft'</span>,</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>          <span class="st">'verizon.net'</span>: <span class="st">'yahoo'</span>, <span class="st">'msn.com'</span>: <span class="st">'microsoft'</span>, <span class="st">'q.com'</span>: <span class="st">'centurylink'</span>, </span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>          <span class="st">'prodigy.net.mx'</span>: <span class="st">'att'</span>, <span class="st">'frontier.com'</span>: <span class="st">'yahoo'</span>, <span class="st">'anonymous.com'</span>: <span class="st">'other'</span>, </span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>          <span class="st">'rocketmail.com'</span>: <span class="st">'yahoo'</span>, <span class="st">'sbcglobal.net'</span>: <span class="st">'att'</span>, <span class="st">'frontiernet.net'</span>: <span class="st">'yahoo'</span>, </span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>          <span class="st">'ymail.com'</span>: <span class="st">'yahoo'</span>, <span class="st">'outlook.com'</span>: <span class="st">'microsoft'</span>, <span class="st">'mail.com'</span>: <span class="st">'other'</span>, </span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>          <span class="st">'bellsouth.net'</span>: <span class="st">'other'</span>, <span class="st">'embarqmail.com'</span>: <span class="st">'centurylink'</span>, <span class="st">'cableone.net'</span>: <span class="st">'other'</span>, </span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>          <span class="st">'hotmail.es'</span>: <span class="st">'microsoft'</span>, <span class="st">'mac.com'</span>: <span class="st">'apple'</span>, <span class="st">'yahoo.co.uk'</span>: <span class="st">'yahoo'</span>, <span class="st">'netzero.com'</span>: <span class="st">'other'</span>, </span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>          <span class="st">'yahoo.com'</span>: <span class="st">'yahoo'</span>, <span class="st">'live.com.mx'</span>: <span class="st">'microsoft'</span>, <span class="st">'ptd.net'</span>: <span class="st">'other'</span>, <span class="st">'cox.net'</span>: <span class="st">'other'</span>,</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>          <span class="st">'aol.com'</span>: <span class="st">'aol'</span>, <span class="st">'juno.com'</span>: <span class="st">'other'</span>, <span class="st">'icloud.com'</span>: <span class="st">'apple'</span>, <span class="st">'NAN'</span>:<span class="st">'NAN'</span>}</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>us_emails <span class="op">=</span> [<span class="st">'gmail'</span>, <span class="st">'net'</span>, <span class="st">'edu'</span>]</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a><span class="co"># https://www.kaggle.com/c/ieee-fraud-detection/discussion/100499#latest-579654</span></span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> c <span class="kw">in</span> [<span class="st">'P_emaildomain'</span>]:</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>    df_trans[c <span class="op">+</span> <span class="st">'_bin'</span>] <span class="op">=</span> df_trans[c].<span class="bu">map</span>(emails)</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>    df_trans[c <span class="op">+</span> <span class="st">'_suffix'</span>] <span class="op">=</span> df_trans[c].<span class="bu">map</span>(<span class="kw">lambda</span> x: <span class="bu">str</span>(x).split(<span class="st">'.'</span>)[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>    <span class="co">#If a suffix matches any of the values in the us_emails list, it's replaced with 'us' to indicate it's a U.S.-based domain. Otherwise, the original suffix remains.</span></span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>    df_trans[c <span class="op">+</span> <span class="st">'_suffix'</span>] <span class="op">=</span> df_trans[c <span class="op">+</span> <span class="st">'_suffix'</span>].<span class="bu">map</span>(<span class="kw">lambda</span> x: x <span class="cf">if</span> <span class="bu">str</span>(x) <span class="kw">not</span> <span class="kw">in</span> us_emails <span class="cf">else</span> <span class="st">'us'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="106">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>ploting_cnt_amt(df_trans, <span class="st">'P_emaildomain_bin'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection2_files/figure-html/cell-38-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="107">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>ploting_cnt_amt(df_trans, <span class="st">'P_emaildomain_suffix'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="Fraud_Detection2_files/figure-html/cell-39-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="r_email-domain" class="level3">
<h3 class="anchored" data-anchor-id="r_email-domain">R_Email domain</h3>
<ol type="1">
<li>Over 76% are missing value, so let’s exlcude this column from further analysis.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="108">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_trans, [<span class="st">'R_emaildomain'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 401)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="108">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>R_emaildomain</td>
      <td>object</td>
      <td>453249</td>
      <td>60</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-execution_count="109">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_trans, <span class="st">'R_emaildomain'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for R_emaildomain: 76.75%</code></pre>
</div>
</div>
</section>
<section id="c1-c14-d1-d9-m1-m9-vxxx" class="level3">
<h3 class="anchored" data-anchor-id="c1-c14-d1-d9-m1-m9-vxxx">C1-C14, D1-D9, M1-M9, Vxxx</h3>
<p>Given that these features are masked and their meanings are not discernible from their values, to prioritize providing more interpretable insights, let’s exclude them from the subsequent analysis.</p>
</section>
</section>
<section id="eda-id" class="level2">
<h2 class="anchored" data-anchor-id="eda-id">6-2. EDA-id</h2>
<div class="cell" data-tags="[]" data-execution_count="110">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_id, df_id.columns.tolist())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (144233, 41)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="110">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>TransactionID</td>
      <td>int32</td>
      <td>0</td>
      <td>144233</td>
      <td>2987004</td>
      <td>2987008</td>
      <td>2987010</td>
    </tr>
    <tr>
      <th>1</th>
      <td>id_01</td>
      <td>float16</td>
      <td>0</td>
      <td>77</td>
      <td>0.0</td>
      <td>-5.0</td>
      <td>-5.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>id_02</td>
      <td>float32</td>
      <td>3361</td>
      <td>115655</td>
      <td>70787.0</td>
      <td>98945.0</td>
      <td>191631.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>id_03</td>
      <td>float16</td>
      <td>77909</td>
      <td>24</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>id_04</td>
      <td>float16</td>
      <td>77909</td>
      <td>15</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>id_05</td>
      <td>float16</td>
      <td>7368</td>
      <td>93</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>id_06</td>
      <td>float16</td>
      <td>7368</td>
      <td>101</td>
      <td>NaN</td>
      <td>-5.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>id_07</td>
      <td>float16</td>
      <td>139078</td>
      <td>84</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>8</th>
      <td>id_08</td>
      <td>float16</td>
      <td>139078</td>
      <td>94</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>9</th>
      <td>id_09</td>
      <td>float16</td>
      <td>69307</td>
      <td>46</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>id_10</td>
      <td>float16</td>
      <td>69307</td>
      <td>62</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>id_11</td>
      <td>float16</td>
      <td>3255</td>
      <td>146</td>
      <td>100.0</td>
      <td>100.0</td>
      <td>100.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>id_12</td>
      <td>object</td>
      <td>0</td>
      <td>2</td>
      <td>NotFound</td>
      <td>NotFound</td>
      <td>NotFound</td>
    </tr>
    <tr>
      <th>13</th>
      <td>id_13</td>
      <td>float16</td>
      <td>16913</td>
      <td>54</td>
      <td>NaN</td>
      <td>49.0</td>
      <td>52.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>id_14</td>
      <td>float16</td>
      <td>64189</td>
      <td>25</td>
      <td>-480.0</td>
      <td>-300.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>15</th>
      <td>id_15</td>
      <td>object</td>
      <td>3248</td>
      <td>3</td>
      <td>New</td>
      <td>New</td>
      <td>Found</td>
    </tr>
    <tr>
      <th>16</th>
      <td>id_16</td>
      <td>object</td>
      <td>14893</td>
      <td>2</td>
      <td>NotFound</td>
      <td>NotFound</td>
      <td>Found</td>
    </tr>
    <tr>
      <th>17</th>
      <td>id_17</td>
      <td>float16</td>
      <td>4864</td>
      <td>104</td>
      <td>166.0</td>
      <td>166.0</td>
      <td>121.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>id_18</td>
      <td>float16</td>
      <td>99120</td>
      <td>18</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>19</th>
      <td>id_19</td>
      <td>float16</td>
      <td>4915</td>
      <td>522</td>
      <td>542.0</td>
      <td>621.0</td>
      <td>410.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>id_20</td>
      <td>float16</td>
      <td>4972</td>
      <td>394</td>
      <td>144.0</td>
      <td>500.0</td>
      <td>142.0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>id_21</td>
      <td>float16</td>
      <td>139074</td>
      <td>490</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>22</th>
      <td>id_22</td>
      <td>float16</td>
      <td>139064</td>
      <td>25</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>23</th>
      <td>id_23</td>
      <td>object</td>
      <td>139064</td>
      <td>3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>24</th>
      <td>id_24</td>
      <td>float16</td>
      <td>139486</td>
      <td>12</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>25</th>
      <td>id_25</td>
      <td>float16</td>
      <td>139101</td>
      <td>341</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>26</th>
      <td>id_26</td>
      <td>float16</td>
      <td>139070</td>
      <td>95</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>27</th>
      <td>id_27</td>
      <td>object</td>
      <td>139064</td>
      <td>2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>28</th>
      <td>id_28</td>
      <td>object</td>
      <td>3255</td>
      <td>2</td>
      <td>New</td>
      <td>New</td>
      <td>Found</td>
    </tr>
    <tr>
      <th>29</th>
      <td>id_29</td>
      <td>object</td>
      <td>3255</td>
      <td>2</td>
      <td>NotFound</td>
      <td>NotFound</td>
      <td>Found</td>
    </tr>
    <tr>
      <th>30</th>
      <td>id_30</td>
      <td>object</td>
      <td>66668</td>
      <td>75</td>
      <td>Android 7.0</td>
      <td>iOS 11.1.2</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>31</th>
      <td>id_31</td>
      <td>object</td>
      <td>3951</td>
      <td>130</td>
      <td>samsung browser 6.2</td>
      <td>mobile safari 11.0</td>
      <td>chrome 62.0</td>
    </tr>
    <tr>
      <th>32</th>
      <td>id_32</td>
      <td>float16</td>
      <td>66647</td>
      <td>4</td>
      <td>32.0</td>
      <td>32.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>33</th>
      <td>id_33</td>
      <td>object</td>
      <td>70944</td>
      <td>260</td>
      <td>2220x1080</td>
      <td>1334x750</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>34</th>
      <td>id_34</td>
      <td>object</td>
      <td>66428</td>
      <td>4</td>
      <td>match_status:2</td>
      <td>match_status:1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>35</th>
      <td>id_35</td>
      <td>object</td>
      <td>3248</td>
      <td>2</td>
      <td>T</td>
      <td>T</td>
      <td>F</td>
    </tr>
    <tr>
      <th>36</th>
      <td>id_36</td>
      <td>object</td>
      <td>3248</td>
      <td>2</td>
      <td>F</td>
      <td>F</td>
      <td>F</td>
    </tr>
    <tr>
      <th>37</th>
      <td>id_37</td>
      <td>object</td>
      <td>3248</td>
      <td>2</td>
      <td>T</td>
      <td>F</td>
      <td>T</td>
    </tr>
    <tr>
      <th>38</th>
      <td>id_38</td>
      <td>object</td>
      <td>3248</td>
      <td>2</td>
      <td>T</td>
      <td>T</td>
      <td>T</td>
    </tr>
    <tr>
      <th>39</th>
      <td>DeviceType</td>
      <td>object</td>
      <td>3423</td>
      <td>2</td>
      <td>mobile</td>
      <td>mobile</td>
      <td>desktop</td>
    </tr>
    <tr>
      <th>40</th>
      <td>DeviceInfo</td>
      <td>object</td>
      <td>25567</td>
      <td>1786</td>
      <td>SAMSUNG SM-G892A Build/NRD90M</td>
      <td>iOS Device</td>
      <td>Windows</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>From the table above, we can select some potentially useful variables including id_30, id_31, DeviceType, DeviceInfo.</p>
<div class="cell" data-execution_count="111">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># merge two df for better analysis</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>df_merged <span class="op">=</span> df_trans.merge(df_id, on<span class="op">=</span><span class="st">'TransactionID'</span>, how<span class="op">=</span><span class="st">'left'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="id_30" class="level3">
<h3 class="anchored" data-anchor-id="id_30">id_30</h3>
<ol type="1">
<li>This column likely represents operation system.</li>
<li>More than 86% are missing values, so we’ll exclude this variable in the following analysis.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="112">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_merged, [<span class="st">'id_30'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 441)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="112">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id_30</td>
      <td>object</td>
      <td>512975</td>
      <td>75</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="113">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_merged, <span class="st">'id_30'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for id_30: 86.87%</code></pre>
</div>
</div>
</section>
<section id="id_31" class="level3">
<h3 class="anchored" data-anchor-id="id_31">id_31</h3>
<ol type="1">
<li>This column likely represents browser type.</li>
<li>More than 70% are missing values, so we’ll exclude this variable in the following analysis.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="119">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_merged, [<span class="st">'id_31'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 441)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="119">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>id_31</td>
      <td>object</td>
      <td>450258</td>
      <td>130</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="120">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_merged, <span class="st">'id_31'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for id_31: 76.25%</code></pre>
</div>
</div>
</section>
<section id="devicetype" class="level3">
<h3 class="anchored" data-anchor-id="devicetype">DeviceType</h3>
<ol type="1">
<li>This column contains only two possibilites: desktop and mobile.</li>
<li>More than 70% are missing values, so we’ll exclude this variable in the following analysis.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="121">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_merged, [<span class="st">'DeviceType'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 441)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="121">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>DeviceType</td>
      <td>object</td>
      <td>449730</td>
      <td>2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="122">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_merged, <span class="st">'DeviceType'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Missing value percentage for DeviceType: 76.16%</code></pre>
</div>
</div>
<div class="cell" data-tags="[]" data-execution_count="123">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>df_merged.DeviceType.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="123">
<pre><code>desktop    85165
mobile     55645
Name: DeviceType, dtype: int64</code></pre>
</div>
</div>
</section>
<section id="deviceinfo" class="level3">
<h3 class="anchored" data-anchor-id="deviceinfo">DeviceInfo</h3>
<ol type="1">
<li>This column also have around 80% missing values, so we’ll also exclude it.</li>
</ol>
<div class="cell" data-tags="[]" data-execution_count="124">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_merged, [<span class="st">'DeviceInfo'</span>])</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>calculate_missing_percentage(df_merged, <span class="st">'DeviceInfo'</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>df_merged.DeviceInfo.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 441)
Missing value percentage for DeviceInfo: 79.91%</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="124">
<pre><code>Windows        47722
iOS Device     19782
MacOS          12573
Trident/7.0     7440
rv:11.0         1901
               ...  
LGMS345            1
verykool           1
XT1072             1
LG-H931            1
0PJA2              1
Name: DeviceInfo, Length: 1786, dtype: int64</code></pre>
</div>
</div>
</section>
</section>
<section id="eda-summary" class="level2">
<h2 class="anchored" data-anchor-id="eda-summary">6-3. EDA Summary</h2>
<p>After reviewing all columns, the following ones are selected for their meaningful content and will be used:</p>
<ul>
<li>Date</li>
<li>_Weekdays</li>
<li>_Hours</li>
<li>_Days</li>
<li>TransactionAmt</li>
<li>Log_TransactionAmt</li>
<li>ProductCD</li>
<li>card4</li>
<li>card6</li>
<li>addr1</li>
<li>P_emaildomain_bin</li>
<li>P_emaildomain_suffix</li>
</ul>
</section>
</section>
<section id="preprocessing" class="level1">
<h1>7. Preprocessing</h1>
<p>imbalance: https://www.kaggle.com/code/shahules/tackling-class-imbalance</p>
<section id="select-useful-columns" class="level2">
<h2 class="anchored" data-anchor-id="select-useful-columns">7-1. Select useful columns</h2>
<div class="cell" data-tags="[]" data-execution_count="136">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>selected_columns <span class="op">=</span> [</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'isFraud'</span>,<span class="st">'Date'</span>, <span class="st">'_Weekdays'</span>, <span class="st">'_Hours'</span>, <span class="st">'_Days'</span>,</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TransactionAmt'</span>, <span class="st">'Log_TransactionAmt'</span>, <span class="st">'ProductCD'</span>, <span class="st">'card4'</span>, <span class="st">'card6'</span>,</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'addr1'</span>, <span class="st">'P_emaildomain_bin'</span>, <span class="st">'P_emaildomain_suffix'</span></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Selecting the specified columns</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>df_train <span class="op">=</span> df_merged[selected_columns]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-tags="[]" data-execution_count="137">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>resumetable(df_train, df_train.columns.tolist())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset Shape: (590540, 13)</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="137">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>Name</th>
      <th>dtypes</th>
      <th>Missing</th>
      <th>Uniques</th>
      <th>First Value</th>
      <th>Second Value</th>
      <th>Third Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>isFraud</td>
      <td>int8</td>
      <td>0</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Date</td>
      <td>datetime64[ns]</td>
      <td>0</td>
      <td>573349</td>
      <td>2017-12-02 00:00:00</td>
      <td>2017-12-02 00:00:01</td>
      <td>2017-12-02 00:01:09</td>
    </tr>
    <tr>
      <th>2</th>
      <td>_Weekdays</td>
      <td>int64</td>
      <td>0</td>
      <td>7</td>
      <td>5</td>
      <td>5</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>_Hours</td>
      <td>int64</td>
      <td>0</td>
      <td>24</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>_Days</td>
      <td>int64</td>
      <td>0</td>
      <td>31</td>
      <td>2</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>5</th>
      <td>TransactionAmt</td>
      <td>float64</td>
      <td>0</td>
      <td>8195</td>
      <td>68.5</td>
      <td>29.0</td>
      <td>59.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Log_TransactionAmt</td>
      <td>float64</td>
      <td>0</td>
      <td>8195</td>
      <td>4.241327</td>
      <td>3.401197</td>
      <td>4.094345</td>
    </tr>
    <tr>
      <th>7</th>
      <td>ProductCD</td>
      <td>object</td>
      <td>0</td>
      <td>5</td>
      <td>W</td>
      <td>W</td>
      <td>W</td>
    </tr>
    <tr>
      <th>8</th>
      <td>card4</td>
      <td>object</td>
      <td>0</td>
      <td>5</td>
      <td>discover</td>
      <td>mastercard</td>
      <td>visa</td>
    </tr>
    <tr>
      <th>9</th>
      <td>card6</td>
      <td>object</td>
      <td>0</td>
      <td>5</td>
      <td>credit</td>
      <td>credit</td>
      <td>debit</td>
    </tr>
    <tr>
      <th>10</th>
      <td>addr1</td>
      <td>object</td>
      <td>0</td>
      <td>333</td>
      <td>315.0</td>
      <td>325.0</td>
      <td>330.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>P_emaildomain_bin</td>
      <td>object</td>
      <td>0</td>
      <td>10</td>
      <td>NAN</td>
      <td>google</td>
      <td>microsoft</td>
    </tr>
    <tr>
      <th>12</th>
      <td>P_emaildomain_suffix</td>
      <td>object</td>
      <td>0</td>
      <td>9</td>
      <td>NAN</td>
      <td>com</td>
      <td>com</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
</section>
<section id="preprocessing-1" class="level2">
<h2 class="anchored" data-anchor-id="preprocessing-1">7-2. Preprocessing</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Splitting into features and target variable</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> data.drop(<span class="st">'isFraud'</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> data[<span class="st">'isFraud'</span>]</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>numeric_features <span class="op">=</span> X.select_dtypes(include<span class="op">=</span>[<span class="st">'float64'</span>, <span class="st">'int64'</span>,<span class="st">'int'</span>]).columns</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>categorical_features <span class="op">=</span> X.select_dtypes(include<span class="op">=</span>[<span class="st">'object'</span>]).columns</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>